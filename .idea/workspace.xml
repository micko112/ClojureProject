<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="4d338447-6f3a-43e8-ab8c-95e214f36644" name="Changes" comment="Leaderboard finito 3, i merged even all-time in default leaderboard fn, so now code is clearer and less messy. Deleted unnecessary fucntion i no longer use. Added 3 tests for 2 for adding activity and 1 for leaderboard.">
      <change afterPath="$PROJECT_DIR$/src/project/api.clj" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/.nrepl-port" beforeDir="false" afterPath="$PROJECT_DIR$/.nrepl-port" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/project.clj" beforeDir="false" afterPath="$PROJECT_DIR$/project.clj" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/src/project/db.clj" beforeDir="false" afterPath="$PROJECT_DIR$/src/project/db.clj" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/src/project/validation.clj" beforeDir="false" afterPath="$PROJECT_DIR$/src/project/validation.clj" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/target/classes/META-INF/maven/ProjectV1/ProjectV1/pom.properties" beforeDir="false" afterPath="$PROJECT_DIR$/target/classes/META-INF/maven/ProjectV1/ProjectV1/pom.properties" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/target/repl-port" beforeDir="false" afterPath="$PROJECT_DIR$/target/repl-port" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/test/project/uredno_test.clj" beforeDir="false" afterPath="$PROJECT_DIR$/test/project/uredno_test.clj" afterDir="false" />
    </list>
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Clojure Namespace" />
      </list>
    </option>
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
  </component>
  <component name="GitHubPullRequestSearchHistory">{
  &quot;lastFilter&quot;: {
    &quot;state&quot;: &quot;OPEN&quot;,
    &quot;assignee&quot;: &quot;micko112&quot;
  }
}</component>
  <component name="GithubPullRequestsUISettings">{
  &quot;selectedUrlAndAccountId&quot;: {
    &quot;url&quot;: &quot;https://github.com/micko112/ClojureProject.git&quot;,
    &quot;accountId&quot;: &quot;3764571a-842a-40c7-838d-20632f3769b4&quot;
  }
}</component>
  <component name="HighlightingSettingsPerFile">
    <setting file="file://$PROJECT_DIR$/src/project/db.clj" root0="FORCE_HIGHLIGHTING" />
  </component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 5
}</component>
  <component name="ProjectId" id="37ZsZpPnuy4tgd50LQGXH7cfGlR" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent">{
  &quot;keyToString&quot;: {
    &quot;Clojure REPL.REPL for ProjectV1.executor&quot;: &quot;Run&quot;,
    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
    &quot;SHARE_PROJECT_CONFIGURATION_FILES&quot;: &quot;true&quot;,
    &quot;cursive.last.file.extension.C\\:/xampp/htdocs/Clojure/Clojure for Brave and True/ProjectV1/src&quot;: &quot;clj&quot;,
    &quot;git-widget-placeholder&quot;: &quot;main&quot;,
    &quot;last_opened_file_path&quot;: &quot;C:/xampp/htdocs/Clojure/Clojure for Brave and True/ProjectV1/project.clj&quot;,
    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
    &quot;settings.editor.selected.configurable&quot;: &quot;preferences.lookFeel&quot;,
    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
  },
  &quot;keyToStringList&quot;: {
    &quot;GitStage.ChangesTree.GroupingKeys&quot;: [
      &quot;directory&quot;,
      &quot;module&quot;,
      &quot;repository&quot;
    ]
  }
}</component>
  <component name="RecentsManager">
    <key name="MoveFile.RECENT_KEYS">
      <recent name="C:\xampp\htdocs\Clojure\Clojure for Brave and True\ProjectV1\src\playground" />
    </key>
  </component>
  <component name="ReplState" timestamp="1768778936605">{:repl-history {:ide [], :local [{:command &quot;(defn get-all-users [] (map first (get-all-users-db (d/db conn))))&quot;, :offset 66, :ns &quot;project.db&quot;} {:command &quot;(ns project.db\n  (:require [datomic.api :as d]\n            [database.schema :as schema]\n            [database.seed :as seed-db]\n            [clojure.string :as str]\n            [project.time :as t]\n            [project.validation :as v]\n            [project.connection :refer [conn]]\n            [malli.core :as m])\n\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId))\n\n  )&quot;, :offset 531, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/all-seed-data)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))&quot;, :offset 280, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.db\n  (:require [datomic.api :as d]\n            [database.schema :as schema]\n            [database.seed :as seed-db]\n            [clojure.string :as str]\n            [project.time :as t]\n            [project.validation :as v]\n            [project.connection :refer [conn]]\n            [malli.core :as m])\n\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId))\n\n  )\n\n(def db-uri \&quot;datomic:dev://localhost:4334/bebetter\&quot;)\n\n\n(def db (d/db conn))\n\n(def user-ids (d/q '[:find ?e .\n                     :where [?e :user/username]]db))\n\n(defn get-all-users-db [db] (d/q '[:find (pull ?e [*])\n                     :where [?e :user/username]] db))\n(defn get-all-users [db] (map first (get-all-users-db db)))\n\n\n(defn create-user! [conn name]\n  (v/validate! v/CreateUserInput {:username name})\n  @(d/transact conn [{:user/username name\n                      :user/xp 0\n                      }]))\n\n(defn add-xp [conn db username xp-to-add]\n  (let [[e current-xp]\n        (first (d/q '[:find ?e ?xp\n                      :in $ ?username\n                      :where [?e :user/username ?username]\n                      [?e :user/xp ?xp]\n                      ]\n                    db username))\n        new-xp (+ current-xp xp-to-add)]\n    @(d/transact conn [[:db/add e :user/xp new-xp]])\n    ))\n\n(def add-xp-tx {:db/ident :user/add-xp\n                :db/fn (d/function\n                         '{:lang \&quot;clojure\&quot;\n                          :params [db username xp]\n                          :code (let [[e current-xp]\n                                      (first (d/q '[:find ?e ?xp\n                                                    :in $ ?username\n                                                    :where [?e :user/username ?username]\n                                                    [?e :user/xp ?xp]\n                                                    ] db username))]\n                                  [[:db/add e :user/xp (+ current-xp xp)]])})})\n\n(def add-activity-tx {:db/ident :activity/add\n                      :db/fn (d/function '{:lang \&quot;clojure\&quot;\n                                           :params [db username activity-type-key duration intensity]\n                                           :code (let [\n                                                       user-e\n                                                       (d/q '[:find ?e .\n                                                              :in $ ?username\n                                                              :where [?e :user/username ?username]]\n                                                            db username)\n                                                       [act-type-e xp-per-min]\n                                                       (first (d/q '[:find ?e ?xp-per-minute\n                                                                     :in $ ?type\n                                                                     :where [?e :activity-type/key ?type]\n                                                                     [?e :activity-type/xp-per-minute ?xp-per-minute]\n                                                                     ] db activity-type-key))\n                                                       gained-xp (* duration xp-per-min intensity)\n\n                                                       current-xp (or (:user/xp (d/entity db user-e)) 0)\n\n                                                       new-xp (+ current-xp gained-xp)\n                                                       activity-id (d/tempid :db.part/user)]\n                                                   [\n                                                    {:db/id activity-id\n                                                     :activity/user user-e\n                                                     :activity/type act-type-e\n                                                     :activity/duration duration\n                                                     :activity/intensity intensity\n                                                     :activity/start-time (java.util.Date.)\n                                                     }\n                                                    [:db/add user-e :user/xp new-xp\n                                                     ]])})})\n\n(defn add-activity! [conn username activity-key duration intensity]\n  (v/validate! v/AddActivityInput {:username username\n                                   :activity-type activity-key\n                                   :duration duration\n                                   :intensity intensity})\n  @(d/transact conn [[:activity/add username activity-key duration intensity]]))\n\n(def get-all-tx-functions [add-xp-tx add-activity-tx])\n\n\n(defn get-user-activities [username]\n  (d/q '[:find ?a-start-time ?a-type ?a-duration ?a-intensity ?xp-per-min\n         :in $ ?username\n         :where  [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?a-type]\n         [?a :activity/intensity ?a-intensity ]\n         [?a :activity/duration ?a-duration]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [?a :activity/start-time ?a-start-time ]\n         ] (d/db conn) username))\n\n(defn get-activities-in-interval\n  [username start-day end-day]\n  (d/q '[:find ?start-time ?type-name ?dur ?int ?xp-per-min\n         :in $ ?username ?start ?end\n         :where\n         [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/start-time ?start-time]\n         [?a :activity/duration ?dur]\n         [?a :activity/intensity ?int]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?type-name]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [(&gt;= ?start-time ?start)]\n         [(&lt; ?start-time ?end)]]\n       (d/db conn) username start-day end-day))\n\n(defn calculate-xp-from-rows [rows]\n  (reduce (fn [total-xp [_ _ dur int xp-per-min]]\n            (+ total-xp (* dur int xp-per-min)))\n          0\n          rows))\n\n(def period-interval\n  {:daily t/day-interval\n   :weekly t/week-interval\n   :monthly t/month-interval\n   :all     nil})\n\n(defn usernames-xp [db] (vec (d/q '[:find ?username ?xp\n                                    :where [?u :user/username ?username]\n                                    [?u :user/xp ?xp]] db)))\n\n(defn xp-per-user [username period date]\n  (let [{:keys [start-day end-day]} ((get period-interval period) date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)\n    ))\n\n(defn get-all-users-xp-per-period [db period date]\n  (reduce (fn [acc [username _]]\n            (let [xp (xp-per-user username period date)]\n              ())) [] (usernames-xp db)))\n\n(defn daily-xp-per-user [username date]\n  (let [{:keys [start-day end-day]} (t/day-interval date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)))\n\n\n\n\n#_(defn get-all-users-daily-xp [db date]\n  (let [[username xp] (usernames-xp db)]\n    (reduce (fn [acc [userna]]\n              (if (&gt; (daily-xp-per-user elm date) 0)\n                (conj acc elm) acc))\n            [] username)))\n\n(defn get-all-users-daily-xp [db date]\n  (reduce (fn [acc [username _]]\n            (let [xp (daily-xp-per-user username date)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn weekly-xp-per-user [username date]\n  (let [{:keys [start-day end-day]} (t/week-interval date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-weekly-xp [db date]\n  (reduce (fn [acc [username _]]\n            (let [xp (weekly-xp-per-user username date)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn monthly-xp-per-user [username date]\n  (let [{:keys [start-day end-day]} (t/month-interval date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-monthly-xp [db date]\n  (reduce (fn [acc [username _]]\n            (let [xp (monthly-xp-per-user username date)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn all-time-xp-per-user [username]\n  (let [rows (get-user-activities username)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-all-time-xp [db]\n  (reduce (fn [acc [username _]]\n            (let [xp (all-time-xp-per-user username)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn clean-username! [conn username]\n  (let [user (d/pull (d/db conn) \&quot;[*]\&quot; [:user/username username])\n        clean-name (str/trim (:user/username user))] ; str/trim skida sav višak razmaka i novih redova\n    @(d/transact conn [{:db/id (:db/id user)\n                        :user/username clean-name}])))\n\n\n&quot;, :offset 9313, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            ))&quot;, :offset 378, :ns &quot;project.db&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            ))\n\n\n(def test-uri \&quot;datomic:mem://bebetter-test\&quot;)\n\n(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/all-seed-data)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))\n\n(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :study 60 3)\n        (:user/xp (first (db/get-all-users (d/db conn))))\n        =&gt; pos?))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;, :offset 964, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :study 60 3)\n        (:user/xp (first (db/get-all-users (d/db conn))))\n        =&gt; pos?))&quot;, :offset 229, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :study 60 3)\n  (:user/xp (first (db/get-all-users (d/db conn))))\n  =&gt; pos?)&quot;, :offset 164, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :study 60 3)\n  (:user/xp (first (db/get-all-users (d/db conn)))))&quot;, :offset 153, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (first (db/get-all-users (d/db conn))))\n        =&gt; pos?))&quot;, :offset 232, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn get-user-by-name [db username]\n  (d/pull db [*] [:user/username username]))&quot;, :offset 81, :ns &quot;project.db&quot;} {:command &quot;(ns project.db\n  (:require [datomic.api :as d]\n            [database.schema :as schema]\n            [database.seed :as seed-db]\n            [clojure.string :as str]\n            [project.time :as t]\n            [project.validation :as v]\n            [project.connection :refer [conn]]\n            [malli.core :as m])\n\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId))\n\n  )\n\n(def db-uri \&quot;datomic:dev://localhost:4334/bebetter\&quot;)\n\n\n(def db (d/db conn))\n\n(def user-ids (d/q '[:find ?e .\n                     :where [?e :user/username]]db))\n\n(defn get-all-users-db [db] (d/q '[:find (pull ?e [*])\n                     :where [?e :user/username]] db))\n(defn get-all-users [db] (map first (get-all-users-db db)))\n\n\n(defn create-user! [conn name]\n  (v/validate! v/CreateUserInput {:username name})\n  @(d/transact conn [{:user/username name\n                      :user/xp 0\n                      }]))\n\n(defn add-xp [conn db username xp-to-add]\n  (let [[e current-xp]\n        (first (d/q '[:find ?e ?xp\n                      :in $ ?username\n                      :where [?e :user/username ?username]\n                      [?e :user/xp ?xp]\n                      ]\n                    db username))\n        new-xp (+ current-xp xp-to-add)]\n    @(d/transact conn [[:db/add e :user/xp new-xp]])\n    ))\n\n(def add-xp-tx {:db/ident :user/add-xp\n                :db/fn (d/function\n                         '{:lang \&quot;clojure\&quot;\n                          :params [db username xp]\n                          :code (let [[e current-xp]\n                                      (first (d/q '[:find ?e ?xp\n                                                    :in $ ?username\n                                                    :where [?e :user/username ?username]\n                                                    [?e :user/xp ?xp]\n                                                    ] db username))]\n                                  [[:db/add e :user/xp (+ current-xp xp)]])})})\n\n(def add-activity-tx {:db/ident :activity/add\n                      :db/fn (d/function '{:lang \&quot;clojure\&quot;\n                                           :params [db username activity-type-key duration intensity]\n                                           :code (let [\n                                                       user-e\n                                                       (d/q '[:find ?e .\n                                                              :in $ ?username\n                                                              :where [?e :user/username ?username]]\n                                                            db username)\n                                                       [act-type-e xp-per-min]\n                                                       (first (d/q '[:find ?e ?xp-per-minute\n                                                                     :in $ ?type\n                                                                     :where [?e :activity-type/key ?type]\n                                                                     [?e :activity-type/xp-per-minute ?xp-per-minute]\n                                                                     ] db activity-type-key))\n                                                       gained-xp (* duration xp-per-min intensity)\n\n                                                       current-xp (or (:user/xp (d/entity db user-e)) 0)\n\n                                                       new-xp (+ current-xp gained-xp)\n                                                       activity-id (d/tempid :db.part/user)]\n                                                   [\n                                                    {:db/id activity-id\n                                                     :activity/user user-e\n                                                     :activity/type act-type-e\n                                                     :activity/duration duration\n                                                     :activity/intensity intensity\n                                                     :activity/start-time (java.util.Date.)\n                                                     }\n                                                    [:db/add user-e :user/xp new-xp\n                                                     ]])})})\n\n(defn add-activity! [conn username activity-key duration intensity]\n  (v/validate! v/AddActivityInput {:username username\n                                   :activity-type activity-key\n                                   :duration duration\n                                   :intensity intensity})\n  @(d/transact conn [[:activity/add username activity-key duration intensity]]))\n\n(def get-all-tx-functions [add-xp-tx add-activity-tx])\n\n(defn get-user-by-name [db username]\n  (d/pull db [*] [:user/username username]))\n\n(defn get-user-activities [username]\n  (d/q '[:find ?a-start-time ?a-type ?a-duration ?a-intensity ?xp-per-min\n         :in $ ?username\n         :where  [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?a-type]\n         [?a :activity/intensity ?a-intensity ]\n         [?a :activity/duration ?a-duration]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [?a :activity/start-time ?a-start-time ]\n         ] (d/db conn) username))\n\n(defn get-activities-in-interval\n  [username start-day end-day]\n  (d/q '[:find ?start-time ?type-name ?dur ?int ?xp-per-min\n         :in $ ?username ?start ?end\n         :where\n         [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/start-time ?start-time]\n         [?a :activity/duration ?dur]\n         [?a :activity/intensity ?int]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?type-name]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [(&gt;= ?start-time ?start)]\n         [(&lt; ?start-time ?end)]]\n       (d/db conn) username start-day end-day))\n\n(defn calculate-xp-from-rows [rows]\n  (reduce (fn [total-xp [_ _ dur int xp-per-min]]\n            (+ total-xp (* dur int xp-per-min)))\n          0\n          rows))\n\n(def period-interval\n  {:daily t/day-interval\n   :weekly t/week-interval\n   :monthly t/month-interval\n   :all     nil})\n\n(defn usernames-xp [db] (vec (d/q '[:find ?username ?xp\n                                    :where [?u :user/username ?username]\n                                    [?u :user/xp ?xp]] db)))\n\n(defn xp-per-user [username period date]\n  (let [{:keys [start-day end-day]} ((get period-interval period) date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)\n    ))\n\n(defn get-all-users-xp-per-period [db period date]\n  (reduce (fn [acc [username _]]\n            (let [xp (xp-per-user username period date)]\n              ())) [] (usernames-xp db)))\n\n(defn daily-xp-per-user [username date]\n  (let [{:keys [start-day end-day]} (t/day-interval date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)))\n\n\n\n\n#_(defn get-all-users-daily-xp [db date]\n  (let [[username xp] (usernames-xp db)]\n    (reduce (fn [acc [userna]]\n              (if (&gt; (daily-xp-per-user elm date) 0)\n                (conj acc elm) acc))\n            [] username)))\n\n(defn get-all-users-daily-xp [db date]\n  (reduce (fn [acc [username _]]\n            (let [xp (daily-xp-per-user username date)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn weekly-xp-per-user [username date]\n  (let [{:keys [start-day end-day]} (t/week-interval date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-weekly-xp [db date]\n  (reduce (fn [acc [username _]]\n            (let [xp (weekly-xp-per-user username date)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn monthly-xp-per-user [username date]\n  (let [{:keys [start-day end-day]} (t/month-interval date)\n        rows (get-activities-in-interval username start-day end-day)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-monthly-xp [db date]\n  (reduce (fn [acc [username _]]\n            (let [xp (monthly-xp-per-user username date)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn all-time-xp-per-user [username]\n  (let [rows (get-user-activities username)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-all-time-xp [db]\n  (reduce (fn [acc [username _]]\n            (let [xp (all-time-xp-per-user username)]\n              (if (&gt; xp 0)\n                (conj acc {:user/username username :user/xp xp})\n                acc)))\n          [] (usernames-xp db)))\n\n(defn clean-username! [conn username]\n  (let [user (d/pull (d/db conn) \&quot;[*]\&quot; [:user/username username])\n        clean-name (str/trim (:user/username user))] ; str/trim skida sav višak razmaka i novih redova\n    @(d/transact conn [{:db/id (:db/id user)\n                        :user/username clean-name}])))\n\n\n&quot;, :offset 9395, :ns &quot;project.uredno-test&quot;} {:command &quot;(get-user-by-name (d/db conn) \&quot;Micko\&quot;)&quot;, :offset 36, :ns &quot;project.db&quot;} {:command &quot;(defn get-user-by-name [db username]\n  (d/pull db \&quot;[*]\&quot; [:user/username username]))&quot;, :offset 83, :ns &quot;project.db&quot;} {:command &quot;(get-user-by-name (d/db conn) \&quot;Milan\&quot;)&quot;, :offset 36, :ns &quot;project.db&quot;} {:command &quot;(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)\n            db-before (d/db conn)]\n\n        ;; ŠPIJUN: Šta je u bazi ODMAH posle 'fresh-conn'?\n        (println \&quot;Svi tipovi aktivnosti:\&quot;)\n        (clojure.pprint/pprint\n          (d/q '[:find ?key ?xp\n                 :where [?e :activity-type/key ?key]\n                 [?e :activity-type/xp-per-minute ?xp]]\n               db-before))\n\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :study 60 3)\n\n        (let [db-after (d/db conn)\n              test-user (db/get-user-by-name db-after \&quot;Test\&quot;)]\n          (:user/xp test-user) =&gt; pos?)))&quot;, :offset 631, :ns &quot;project.uredno-test&quot;} {:command &quot;(def add-xp-tx {:db/ident :user/add-xp\n                :db/fn (d/function\n                         '{:lang \&quot;clojure\&quot;\n                          :params [db username xp]\n                          :code (let [[e current-xp]\n                                      (first (d/q '[:find ?e ?xp\n                                                    :in $ ?username\n                                                    :where [?e :user/username ?username]\n                                                    [?e :user/xp ?xp]\n                                                    ] db username))]\n                                  [[:db/add e :user/xp (+ current-xp xp)]])})})\n\n(def add-activity-tx {:db/ident :activity/add\n                      :db/fn (d/function '{:lang \&quot;clojure\&quot;\n                                           :params [db username activity-type-key duration intensity]\n                                           :code (let [\n                                                       user-e\n                                                       (d/q '[:find ?e .\n                                                              :in $ ?username\n                                                              :where [?e :user/username ?username]]\n                                                            db username)\n                                                       [act-type-e xp-per-min]\n                                                       (first (d/q '[:find ?e ?xp-per-minute\n                                                                     :in $ ?type\n                                                                     :where [?e :activity-type/key ?type]\n                                                                     [?e :activity-type/xp-per-minute ?xp-per-minute]\n                                                                     ] db activity-type-key))\n                                                       gained-xp (* duration xp-per-min intensity)\n\n                                                       current-xp (or (:user/xp (d/entity db user-e)) 0)\n\n                                                       new-xp (+ current-xp gained-xp)\n                                                       activity-id (d/tempid :db.part/user)]\n                                                   [\n                                                    {:db/id activity-id\n                                                     :activity/user user-e\n                                                     :activity/type act-type-e\n                                                     :activity/duration duration\n                                                     :activity/intensity intensity\n                                                     :activity/start-time (java.util.Date.)\n                                                     }\n                                                    [:db/add user-e :user/xp new-xp\n                                                     ]])})})\n\n(defn add-activity! [conn username activity-key duration intensity]\n  (v/validate! v/AddActivityInput {:username username\n                                   :activity-type activity-key\n                                   :duration duration\n                                   :intensity intensity})\n  @(d/transact conn [[:activity/add username activity-key duration intensity]]))\n\n(def get-all-tx-functions [add-xp-tx add-activity-tx])&quot;, :offset 3438, :ns &quot;project.db&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            ))\n\n\n(def test-uri \&quot;datomic:mem://bebetter-test\&quot;)\n\n(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/all-seed-data)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))\n\n(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (first (db/get-all-users (d/db conn))))\n        =&gt; pos?))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;, :offset 967, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (:user/xp (first (db/get-all-users (d/db conn))))\n  )&quot;, :offset 159, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;user get xp from activity\&quot;\n      (let [con (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (first (db/get-all-users (d/db con))))\n        =&gt; pos?))&quot;, :offset 230, :ns &quot;project.uredno-test&quot;} {:command &quot;(def user-ids (d/q '[:find ?e .\n                     :where [?e :user/username]] (d/db conn)))&quot;, :offset 94, :ns &quot;project.db&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            ))\n\n\n(def test-uri \&quot;datomic:mem://bebetter-test\&quot;)\n\n(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/all-seed-data)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))\n\n(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)\n            db (d/db conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (first (db/get-all-users db)))\n        =&gt; pos?))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;, :offset 985, :ns &quot;project.core&quot;} {:command &quot;(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (let [db (d/db conn)]\n          (:user/xp (first (db/get-all-users db)))\n          =&gt; pos?)))&quot;, :offset 258, :ns &quot;project.uredno-test&quot;} {:command &quot;(db/add-activity! conn \&quot;Test\&quot; :training 60 3)&quot;, :offset 45, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (:user/xp (first (db/get-all-users db)))\n  )&quot;, :offset 172, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (:user/xp (first (db/get-all-users (d/db conn) )))\n  )&quot;, :offset 182, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (:user/xp\n    (first (db/get-all-users (d/db conn)))))&quot;, :offset 161, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn find-user [db username]\n  (first\n    (filter #(= (:user/username %) username)\n            (db/get-all-users db))))&quot;, :offset 120, :ns &quot;project.uredno-test&quot;} {:command &quot;(:user/xp (first (db/get-all-users db)))&quot;, :offset 40, :ns &quot;project.uredno-test&quot;} {:command &quot;(:user/xp (first (db/get-all-users (d/db conndb))))&quot;, :offset 45, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (reduce (fn [acc elm] (conj acc elm)  )(:user/xp (db/get-all-users (d/db conn))) )\n  )&quot;, :offset 214, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (reduce (fn [acc elm] (+ acc elm))(:user/xp (db/get-all-users (d/db conn))))\n  )&quot;, :offset 208, :ns &quot;project.uredno-test&quot;} {:command &quot;(map first (:user/xp (db/get-all-users (d/db conn))))&quot;, :offset 11, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (:user/xp (first (db/get-all-users (d/db conn) )))\n  )&quot;, :offset 161, :ns &quot;project.uredno-test&quot;} {:command &quot;(:user/xp (first (db/get-all-users (d/db conn) )))&quot;, :offset 50, :ns &quot;project.uredno-test&quot;} {:command &quot;(:user/xp (db/get-all-users (d/db conn)))&quot;, :offset 41, :ns &quot;project.uredno-test&quot;} {:command &quot;(map + (:user/xp (db/get-all-users (d/db conn))))&quot;, :offset 6, :ns &quot;project.uredno-test&quot;} {:command &quot;((db/get-all-users (d/db conn)) :user/xp)&quot;, :offset 41, :ns &quot;project.uredno-test&quot;} {:command &quot;(:user/xp (first (db/get-all-users (d/db conn))))&quot;, :offset 17, :ns &quot;project.uredno-test&quot;} {:command &quot;(map (:user/xp (first (db/get-all-users (d/db conn)))))&quot;, :offset 5, :ns &quot;project.uredno-test&quot;} {:command &quot;(map :user/xp (first (db/get-all-users (d/db conn))))&quot;, :offset 53, :ns &quot;project.uredno-test&quot;} {:command &quot;(map :user/xp (map first (db/get-all-users (d/db conn))))&quot;, :offset 19, :ns &quot;project.uredno-test&quot;} {:command &quot;(:user/xp (map first (db/get-all-users (d/db conn))))&quot;, :offset 53, :ns &quot;project.uredno-test&quot;} {:command &quot;(map first (db/get-all-users (d/db conn))\n     )&quot;, :offset 47, :ns &quot;project.uredno-test&quot;} {:command &quot;(map (:user/xp (db/get-all-users (d/db conn))))&quot;, :offset 45, :ns &quot;project.uredno-test&quot;} {:command &quot;(map :user/xp (db/get-all-users (d/db conn))\n     )&quot;, :offset 50, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (reduce (fn [acc elm] (conj acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                            ))\n  )&quot;, :offset 260, :ns &quot;project.uredno-test&quot;} {:command &quot;(reduce (fn [acc elm] (conj acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                          ))&quot;, :offset 126, :ns &quot;project.uredno-test&quot;} {:command &quot;(reduce (fn [acc elm]\n          (cons acc elm)) (map :user/xp (db/get-all-users (d/db conn))\n                                          ))&quot;, :offset 37, :ns &quot;project.uredno-test&quot;} {:command &quot;(reduce (fn [acc elm]\n          (+ acc elm)) (map :user/xp (db/get-all-users (d/db conn))\n                                          ))&quot;, :offset 34, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (reduce (fn [acc elm] (+ acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                            ))\n  )&quot;, :offset 257, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.leaderboard\n  (:require [project.db :as db]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [project.time :as t]\n            [clojure.pprint :refer [print-table]])\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId)))\n\n\n(defn desc [a b] ; nasao sam na guglu kako se sortira od najveceg ka najmanjem.\n  (compare b a))\n\n;leadreboard for all users\n; (db/get-all-users (d/db conn))\n(defn\n  leaderboard\n  \&quot;users Leaderboard by earned XP\&quot;\n  [users]\n  (sort-by :user/xp desc (map first users)))\n\n(defn leaderboard [db period date]\n  (sort-by :xp &gt; (filter #(pos? (:xp %)) (map (fn [user]\n                                                {:user/username (:user/username user)\n                                                 :xp (db/xp-per-user (:user/username user) period date)})\n                                              (db/get-all-users db)))))\n(defn\n  leaderboard-all-time\n  \&quot;ALL TIME LEADERBOARD\&quot;\n  [db]\n  (print-table\n    (sort-by :user/xp &gt; (db/get-all-users-all-time-xp db))))\n\n&quot;, :offset 1195, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn leaderboard [db period date]\n  (sort-by :xp &gt; (map (fn [user]\n                        {:user/username (:user/username user)\n                         :xp (db/xp-per-user (:user/username user) period date)})\n                      (db/get-all-users db))))&quot;, :offset 258, :ns &quot;project.leaderboard&quot;} {:command &quot;(leaderboard (d/db conn) :daily (LocalDate/now))&quot;, :offset 46, :ns &quot;project.leaderboard&quot;} {:command &quot;(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)\n            db (d/db conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (reduce (fn [acc elm] (+ acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                               ))\n        =&gt; pos?))&quot;, :offset 338, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            ))\n\n\n(def test-uri \&quot;datomic:mem://bebetter-test\&quot;)\n\n(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/all-seed-data)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))\n\n(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)\n            db (d/db conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (reduce (fn [acc elm] (+ acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                               ))\n        =&gt; pos?))\n\n(defn find-user [db username]\n  (first\n    (filter #(= (:user/username %) username)\n            (db/get-all-users db))))\n\n(fact \&quot;user gets xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (find-user (d/db conn) \&quot;Test\&quot;))\n        =&gt; pos?))\n\n(let [conn (fresh-conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (:user/xp (first (db/get-all-users (d/db conn) )))\n  )\n\n(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;, :offset 1715, :ns &quot;project.leaderboard&quot;} {:command &quot;(defn get-all-users-all-time-xp [db]\n  (reduce (fn [acc [username _]]\n            (let [xp (all-time-xp-per-user username)]\n              (conj acc {:user/username username :user/xp xp})))\n          [] (usernames-xp db)))&quot;, :offset 221, :ns &quot;project.db&quot;} {:command &quot;(defn\n  leaderboard-all-time\n  \&quot;ALL TIME LEADERBOARD\&quot;\n  [db]\n  (sort-by :user/xp &gt; (db/get-all-users-all-time-xp db)))&quot;, :offset 118, :ns &quot;project.leaderboard&quot;} {:command &quot;(l)&quot;, :offset 2} {:command &quot;(fact \&quot;leaderboard sorts users by xp descending\&quot;\n      (let [conn (fresh-conn)\n             (db/create-user! conn \&quot;A\&quot;)\n             (db/create-user! conn \&quot;B\&quot;)\n             (db/create-user! conn \&quot;C\&quot;)\n            (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n            (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n            (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n               (lb/leaderboard-all-time (d/db conn))]\n\n        (map :user/username)\n        =&gt; [\&quot;B\&quot; \&quot;C\&quot; \&quot;A\&quot;]))&quot;, :offset 445, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      db (d/db conn)]\n  (db/create-user! conn \&quot;Test\&quot;)\n  (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n  (reduce (fn [acc elm] (+ acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                         )))&quot;, :offset 250, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _    (db/create-user! conn \&quot;A\&quot;)\n      _    (db/create-user! conn \&quot;B\&quot;)\n      _    (db/create-user! conn \&quot;C\&quot;)\n\n      _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n      _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n      _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n      lb   (lb/leaderboard-all-time (d/db conn))]\n\n  (map [:user/username :user/xp] lb)\n )&quot;, :offset 410, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/initial-type-activities)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))&quot;, :offset 290, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            )\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId)))\n\n\n(def test-uri \&quot;datomic:mem://bebetter-test\&quot;)\n\n(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/initial-type-activities)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))\n\n(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)\n            db (d/db conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (reduce (fn [acc elm] (+ acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                               ))\n        =&gt; pos?))\n\n(defn find-user [db username]\n  (first\n    (filter #(= (:user/username %) username)\n            (db/get-all-users db))))\n\n(fact \&quot;user gets xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (find-user (d/db conn) \&quot;Test\&quot;))\n        =&gt; pos?))\n\n\n;(lb/leaderboard (d/db conn) :daily (LocalDate/now))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;, :offset 1695, :ns &quot;project.uredno-test&quot;} {:command &quot;(lb/leaderboard (d/db conn) :daily )&quot;, :offset 36} {:command &quot;(let [conn (fresh-conn)\n      _    (db/create-user! conn \&quot;A\&quot;)\n      _    (db/create-user! conn \&quot;B\&quot;)\n      _    (db/create-user! conn \&quot;C\&quot;)\n\n      _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n      _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n      _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n      lb   (lb/leaderboard-all-time (d/db conn))]\n\n  (map :user/xp lb)\n )&quot;, :offset 401, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _    (db/create-user! conn \&quot;A\&quot;)\n      _    (db/create-user! conn \&quot;B\&quot;)\n      _    (db/create-user! conn \&quot;C\&quot;)\n\n      _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n      _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n      _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n      lb   (lb/leaderboard-all-time (d/db conn))]\n\n  (map :user/username lb)\n )&quot;, :offset 406, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _    (db/create-user! conn \&quot;A\&quot;)\n      _    (db/create-user! conn \&quot;B\&quot;)\n      _    (db/create-user! conn \&quot;C\&quot;)\n\n      _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n      _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n      _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n      lb   (lb/leaderboard-all-time (d/db conn))]\n\n  (map :user/xp lb)\n  )\n=&gt; (0 0 0)\n(let [conn (fresh-conn)\n      _    (db/create-user! conn \&quot;A\&quot;)\n      _    (db/create-user! conn \&quot;B\&quot;)\n      _    (db/create-user! conn \&quot;C\&quot;)\n\n      _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n      _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n      _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n      lb   (lb/leaderboard-all-time (d/db conn))]\n\n  (map :user/username lb)\n  )\n=&gt; (\&quot;B\&quot; \&quot;A\&quot; \&quot;C\&quot;)&quot;, :offset 839, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;leaderboard sorts users by xp descending\&quot;\n      (let [conn (fresh-conn)\n            _    (db/create-user! conn \&quot;A\&quot;)\n            _    (db/create-user! conn \&quot;B\&quot;)\n            _    (db/create-user! conn \&quot;C\&quot;)\n\n            _    (db/add-activity! conn \&quot;A\&quot; :training 60 5) ; 60 xp\n            _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n            _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n            lb   (lb/leaderboard-all-time (d/db conn))]\n\n        (map :user/username lb)\n        =&gt; [\&quot;B\&quot; \&quot;C\&quot; \&quot;A\&quot;]))&quot;, :offset 270, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn tester-leaderboard [db]\n  (-&gt;&gt; (db/get-all-users db)\n       (sort-by\n         (fn [u] [(- (:user/xp u)) (:user/username u)]))))&quot;, :offset 133, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;leaderboard sorts users by xp descending\&quot;\n      (let [conn (fresh-conn)\n            _    (db/create-user! conn \&quot;A\&quot;)\n            _    (db/create-user! conn \&quot;B\&quot;)\n            _    (db/create-user! conn \&quot;C\&quot;)\n\n            _    (db/add-activity! conn \&quot;A\&quot; :training 60 5) ; 60 xp\n            _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n            _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n            lb   (tester-leaderboard (d/db conn))]\n\n        (map :user/username lb)\n        =&gt; [\&quot;B\&quot; \&quot;C\&quot; \&quot;A\&quot;]))&quot;, :offset 455, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;leaderboard sorts users by xp descending\&quot;\n      (let [conn (fresh-conn)\n            _    (db/create-user! conn \&quot;A\&quot;)\n            _    (db/create-user! conn \&quot;B\&quot;)\n            _    (db/create-user! conn \&quot;C\&quot;)\n\n            _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n            _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n            _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n            lb   (tester-leaderboard (d/db conn))]\n\n        (map :user/username lb)\n        =&gt; [\&quot;B\&quot; \&quot;C\&quot; \&quot;A\&quot;]))&quot;, :offset 270, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn\n  leaderboard-all-time\n  \&quot;ALL TIME LEADERBOARD\&quot;\n  [db]\n  (sort-by :user/xp desc (db/get-all-users-all-time-xp db)))&quot;, :offset 121, :ns &quot;project.leaderboard&quot;} {:command &quot;(fact \&quot;leaderboard sorts users by xp descending\&quot;\n      (let [conn (fresh-conn)\n            _    (db/create-user! conn \&quot;A\&quot;)\n            _    (db/create-user! conn \&quot;B\&quot;)\n            _    (db/create-user! conn \&quot;C\&quot;)\n\n            _    (db/add-activity! conn \&quot;A\&quot; :training 60 1) ; 60 xp\n            _    (db/add-activity! conn \&quot;B\&quot; :training 60 3) ; 180 xp\n            _    (db/add-activity! conn \&quot;C\&quot; :training 60 2) ; 120 xp\n\n            lb   (lb/leaderboard-all-time (d/db conn))]\n\n        (map :user/username lb)\n        =&gt; [\&quot;B\&quot; \&quot;C\&quot; \&quot;A\&quot;]))&quot;, :offset 396, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn xp-per-user [db username period date]\n  (if (= period :all)\n    (:user/xp (get-user-by-name db username))\n    (let [{:keys [start-day end-day]} ((get period-interval period) date)\n          rows (get-activities-in-interval username start-day end-day)]\n                        (calculate-xp-from-rows rows))\n                      )\n  )&quot;, :offset 340, :ns &quot;project.db&quot;} {:command &quot;(defn leaderboard [db period date]\n  (sort-by :xp &gt; (map (fn [user]\n                        {:user/username (:user/username user)\n                         :xp (db/xp-per-user db (:user/username user) period date)})\n                      (db/get-all-users db))))&quot;, :offset 261, :ns &quot;project.leaderboard&quot;} {:command &quot;(lb/leaderboard (d/db conn) :monthly (LocalDate/now))&quot;, :offset 36, :ns &quot;project.uredno-test&quot;} {:command &quot;(lb/leaderboard (d/db conn) :weekly (LocalDate/now))&quot;, :offset 35, :ns &quot;project.uredno-test&quot;} {:command &quot;(lb/leaderboard (d/db conn) :daily (LocalDate/now))&quot;, :offset 34, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _ (db/create-user! conn \&quot;A\&quot;)\n      _ (db/create-user! conn \&quot;B\&quot;)\n      _ (db/create-user! conn \&quot;C\&quot;)\n      _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n      _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n      _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n      lb (lb/leaderboard (d/db conn) :all (LocalDate/now))\n      ])&quot;, :offset 349, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.db\n  (:require [datomic.api :as d]\n            [clojure.string :as str]\n            [project.time :as t]\n            [project.validation :as v]\n            )\n\n  (:import (java.util Date)))\n\n\n(defn create-user! [conn name]\n  (v/validate! v/CreateUserInput {:username name})\n  @(d/transact conn [{:user/username name\n                      :user/xp 0\n                      }]))\n\n(defn add-activity! [conn username activity-key duration intensity]\n  (v/validate! v/AddActivityInput {:username username\n                                   :activity-type activity-key\n                                   :duration duration\n                                   :intensity intensity})\n  @(d/transact conn [[:activity/add username activity-key duration intensity]]))\n\n\n(def user-ids (d/q '[:find ?e .\n                     :where [?e :user/username]] (d/db conn)))\n\n(defn get-all-users [db] (map first (d/q '[:find (pull ?e [*])\n                     :where [?e :user/username]] db)))\n\n(defn get-user-by-name [db username]\n  (d/pull db \&quot;[*]\&quot; [:user/username username]))\n\n(defn get-user-activities [username]\n  (d/q '[:find ?a-start-time ?a-type ?a-duration ?a-intensity ?xp-per-min\n         :in $ ?username\n         :where  [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?a-type]\n         [?a :activity/intensity ?a-intensity ]\n         [?a :activity/duration ?a-duration]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [?a :activity/start-time ?a-start-time ]\n         ] (d/db conn) username))\n\n(defn get-activities-in-interval\n  [username start-day end-day]\n  (d/q '[:find ?start-time ?type-name ?dur ?int ?xp-per-min\n         :in $ ?username ?start ?end\n         :where\n         [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/start-time ?start-time]\n         [?a :activity/duration ?dur]\n         [?a :activity/intensity ?int]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?type-name]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [(&gt;= ?start-time ?start)]\n         [(&lt; ?start-time ?end)]]\n       (d/db conn) username start-day end-day))\n\n(defn calculate-xp-from-rows [rows]\n  (reduce (fn [total-xp [_ _ dur int xp-per-min]]\n            (+ total-xp (* dur int xp-per-min)))\n          0\n          rows))\n\n(def period-interval\n  {:daily t/day-interval\n   :weekly t/week-interval\n   :monthly t/month-interval\n   :all     nil})\n\n(defn add-xp [conn db username xp-to-add]\n  (let [[e current-xp]\n        (first (d/q '[:find ?e ?xp\n                      :in $ ?username\n                      :where [?e :user/username ?username]\n                      [?e :user/xp ?xp]\n                      ]\n                    db username))\n        new-xp (+ current-xp xp-to-add)]\n    @(d/transact conn [[:db/add e :user/xp new-xp]])\n    ))\n\n\n\n\n\n\n\n(def add-xp-tx {:db/ident :user/add-xp\n                :db/fn (d/function\n                         '{:lang \&quot;clojure\&quot;\n                          :params [db username xp]\n                          :code (let [[e current-xp]\n                                      (first (d/q '[:find ?e ?xp\n                                                    :in $ ?username\n                                                    :where [?e :user/username ?username]\n                                                    [?e :user/xp ?xp]\n                                                    ] db username))]\n                                  [[:db/add e :user/xp (+ current-xp xp)]])})})\n\n(def add-activity-tx\n  {:db/ident :activity/add\n   :db/fn (d/function\n            '{:lang \&quot;clojure\&quot;\n              :params [db username activity-type-key duration intensity]\n              :code (let [\n                          user-e\n                          (d/q '[:find ?e .\n                                 :in $ ?username\n                                 :where [?e :user/username ?username]]\n                               db username)\n                          [act-type-e xp-per-min]\n                          (first (d/q '[:find ?e ?xp-per-minute\n                                        :in $ ?type\n                                        :where [?e :activity-type/key ?type]\n                                        [?e :activity-type/xp-per-minute ?xp-per-minute]\n                                        ] db activity-type-key))\n                          gained-xp (* duration xp-per-min intensity)\n\n                          current-xp (or (:user/xp (d/entity db user-e)) 0)\n\n                          new-xp (+ current-xp gained-xp)\n                          activity-id (d/tempid :db.part/user)]\n                      [\n                       {:db/id activity-id\n                        :activity/user user-e\n                        :activity/type act-type-e\n                        :activity/duration duration\n                        :activity/intensity intensity\n                        :activity/start-time (java.util.Date.)\n                        }\n                       [:db/add user-e :user/xp new-xp\n                        ]])})})\n\n(def get-all-tx-functions [add-xp-tx add-activity-tx])\n\n(defn usernames-xp [db] (vec (d/q '[:find ?username ?xp\n                                    :where [?u :user/username ?username]\n                                    [?u :user/xp ?xp]] db)))\n\n(defn xp-per-user [db username period date]\n  (if (= period :all)\n    (:user/xp (get-user-by-name db username))\n    (let [{:keys [start-day end-day]} ((get period-interval period) date)\n          rows (get-activities-in-interval username start-day end-day)]\n                        (calculate-xp-from-rows rows))\n                      )\n  )\n\n(defn all-time-xp-per-user [username]\n  (let [rows (get-user-activities username)]\n    (calculate-xp-from-rows rows)))\n\n(defn get-all-users-all-time-xp [db]\n  (reduce (fn [acc [username _]]\n            (let [xp (all-time-xp-per-user username)]\n              (conj acc {:user/username username :user/xp xp})))\n          [] (usernames-xp db)))\n\n\n\n\n&quot;, :offset 6052, :ns &quot;project.uredno-test&quot;} {:command &quot;(get-all-users)&quot;, :offset 14, :ns &quot;project.db&quot;} {:command &quot;(db/get-all-users)&quot;, :offset 4, :ns &quot;project.uredno-test&quot;} {:command &quot;(db/get-all-users (d/db conn))&quot;, :offset 28, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn leaderboard [db period date]\n  (sort-by :xp &gt; (map (fn [user]\n                        {:user/username (:user/username user)\n                         :user/xp (db/xp-per-user db (:user/username user) period date)})\n                      (db/get-all-users db))))&quot;, :offset 266, :ns &quot;project.leaderboard&quot;} {:command &quot;(fact \&quot;leaderboard sort users by xp desc\&quot;\n      (let [conn (fresh-conn)\n            _ (db/create-user! conn \&quot;A\&quot;)\n            _ (db/create-user! conn \&quot;B\&quot;)\n            _ (db/create-user! conn \&quot;C\&quot;)\n            _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n            _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n            _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n            lb (lb/leaderboard (d/db conn) :all (LocalDate/now))\n            ]\n        (map :user/xp lb))\n      =&gt; [\&quot;B\&quot; \&quot;A\&quot; \&quot;C\&quot;])&quot;, :offset 495, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _ (db/create-user! conn \&quot;A\&quot;)\n      _ (db/create-user! conn \&quot;B\&quot;)\n      _ (db/create-user! conn \&quot;C\&quot;)\n      _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n      _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n      _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n      lb (lb/leaderboard (d/db conn) :all (LocalDate/now))\n      ]\n  (map :user/xp lb))&quot;, :offset 369, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            )\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId)))\n\n\n(def test-uri \&quot;datomic:mem://bebetter-test\&quot;)\n\n(defn fresh-conn []\n  (let [uri test-uri]\n    (d/delete-database uri)\n    (d/create-database uri)\n    (let [conn (d/connect uri)]\n      @(d/transact conn schema/all-schemas)\n      @(d/transact conn seed/initial-type-activities)\n      @(d/transact conn db/get-all-tx-functions)\n      conn)))\n\n(fact \&quot;user get xp from activity\&quot;\n      (let [conn (fresh-conn)\n            db (d/db conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (reduce (fn [acc elm] (+ acc elm))(map :user/xp (db/get-all-users (d/db conn))\n                                               ))\n        =&gt; pos?))\n\n(defn find-user [db username]\n  (first\n    (filter #(= (:user/username %) username)\n            (db/get-all-users db))))\n\n(fact \&quot;user gets xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (find-user (d/db conn) \&quot;Test\&quot;))\n        =&gt; pos?))\n\n(fact \&quot;leaderboard sort users by xp desc\&quot;\n      (let [conn (fresh-conn)\n            _ (db/create-user! conn \&quot;A\&quot;)\n            _ (db/create-user! conn \&quot;B\&quot;)\n            _ (db/create-user! conn \&quot;C\&quot;)\n            _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n            _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n            _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n            lb (lb/leaderboard (d/db conn) :all (LocalDate/now))\n            ]\n        (map :user/xp lb))\n      =&gt; [\&quot;B\&quot; \&quot;A\&quot; \&quot;C\&quot;])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&quot;, :offset 2140, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _ (db/create-user! conn \&quot;A\&quot;)\n      _ (db/create-user! conn \&quot;B\&quot;)\n      _ (db/create-user! conn \&quot;C\&quot;)\n      _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n      _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n      _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n      lb (lb/leaderboard (d/db conn) :all (LocalDate/now))\n      ]\n  lb)&quot;, :offset 354, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;user gets xp from activity\&quot;\n      (let [conn (fresh-conn)]\n        (db/create-user! conn \&quot;Test\&quot;)\n        (db/add-activity! conn \&quot;Test\&quot; :training 60 3)\n        (:user/xp (find-user (d/db conn) \&quot;Test\&quot;))\n        =&gt; pos?))&quot;, :offset 225, :ns &quot;project.uredno-test&quot;} {:command &quot;(defn leaderboard [db period date]\n  (sort-by :user/xp &gt; (map (fn [user]\n                        {:user/username (:user/username user)\n                         :user/xp (db/xp-per-user db (:user/username user) period date)})\n                      (db/get-all-users db))))&quot;, :offset 271, :ns &quot;project.leaderboard&quot;} {:command &quot;(lb/leaderboard (d/db conn) :all (LocalDate/now))&quot;, :offset 47, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.db\n  (:require [datomic.api :as d]\n            [clojure.string :as str]\n            [project.time :as t]\n            [project.validation :as v]\n            )\n\n  (:import (java.util Date)))\n\n\n(defn create-user! [conn name]\n  (v/validate! v/CreateUserInput {:username name})\n  @(d/transact conn [{:user/username name\n                      :user/xp 0\n                      }]))\n\n(defn add-activity! [conn username activity-key duration intensity]\n  (v/validate! v/AddActivityInput {:username username\n                                   :activity-type activity-key\n                                   :duration duration\n                                   :intensity intensity})\n  @(d/transact conn [[:activity/add username activity-key duration intensity]]))\n\n\n(def user-ids (d/q '[:find ?e .\n                     :where [?e :user/username]] (d/db conn)))\n\n(defn get-all-users [db] (map first (d/q '[:find (pull ?e [*])\n                     :where [?e :user/username]] db)))\n\n(defn get-user-by-name [db username]\n  (d/pull db \&quot;[*]\&quot; [:user/username username]))\n\n(defn get-user-activities [db username]\n  (d/q '[:find ?a-start-time ?a-type ?a-duration ?a-intensity ?xp-per-min\n         :in $ ?username\n         :where  [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?a-type]\n         [?a :activity/intensity ?a-intensity ]\n         [?a :activity/duration ?a-duration]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [?a :activity/start-time ?a-start-time ]\n         ] db username))\n\n(defn get-activities-in-interval\n  [db username start-day end-day]\n  (d/q '[:find ?start-time ?type-name ?dur ?int ?xp-per-min\n         :in $ ?username ?start ?end\n         :where\n         [?u :user/username ?username]\n         [?a :activity/user ?u]\n         [?a :activity/start-time ?start-time]\n         [?a :activity/duration ?dur]\n         [?a :activity/intensity ?int]\n         [?a :activity/type ?t]\n         [?t :activity-type/name ?type-name]\n         [?t :activity-type/xp-per-minute ?xp-per-min]\n         [(&gt;= ?start-time ?start)]\n         [(&lt; ?start-time ?end)]]\n       db username start-day end-day))\n\n(defn calculate-xp-from-rows [rows]\n  (reduce (fn [total-xp [_ _ dur int xp-per-min]]\n            (+ total-xp (* dur int xp-per-min)))\n          0\n          rows))\n\n(def period-interval\n  {:daily t/day-interval\n   :weekly t/week-interval\n   :monthly t/month-interval\n   :all     nil})\n\n(defn add-xp [conn db username xp-to-add]\n  (let [[e current-xp]\n        (first (d/q '[:find ?e ?xp\n                      :in $ ?username\n                      :where [?e :user/username ?username]\n                      [?e :user/xp ?xp]\n                      ]\n                    db username))\n        new-xp (+ current-xp xp-to-add)]\n    @(d/transact conn [[:db/add e :user/xp new-xp]])\n    ))\n\n\n\n\n\n\n\n(def add-xp-tx {:db/ident :user/add-xp\n                :db/fn (d/function\n                         '{:lang \&quot;clojure\&quot;\n                          :params [db username xp]\n                          :code (let [[e current-xp]\n                                      (first (d/q '[:find ?e ?xp\n                                                    :in $ ?username\n                                                    :where [?e :user/username ?username]\n                                                    [?e :user/xp ?xp]\n                                                    ] db username))]\n                                  [[:db/add e :user/xp (+ current-xp xp)]])})})\n\n(def add-activity-tx\n  {:db/ident :activity/add\n   :db/fn (d/function\n            '{:lang \&quot;clojure\&quot;\n              :params [db username activity-type-key duration intensity]\n              :code (let [\n                          user-e\n                          (d/q '[:find ?e .\n                                 :in $ ?username\n                                 :where [?e :user/username ?username]]\n                               db username)\n                          [act-type-e xp-per-min]\n                          (first (d/q '[:find ?e ?xp-per-minute\n                                        :in $ ?type\n                                        :where [?e :activity-type/key ?type]\n                                        [?e :activity-type/xp-per-minute ?xp-per-minute]\n                                        ] db activity-type-key))\n                          gained-xp (* duration xp-per-min intensity)\n\n                          current-xp (or (:user/xp (d/entity db user-e)) 0)\n\n                          new-xp (+ current-xp gained-xp)\n                          activity-id (d/tempid :db.part/user)]\n                      [\n                       {:db/id activity-id\n                        :activity/user user-e\n                        :activity/type act-type-e\n                        :activity/duration duration\n                        :activity/intensity intensity\n                        :activity/start-time (java.util.Date.)\n                        }\n                       [:db/add user-e :user/xp new-xp\n                        ]])})})\n\n(def get-all-tx-functions [add-xp-tx add-activity-tx])\n\n(defn usernames-xp [db] (vec (d/q '[:find ?username ?xp\n                                    :where [?u :user/username ?username]\n                                    [?u :user/xp ?xp]] db)))\n\n(defn xp-per-user [db username period date]\n  (if (= period :all)\n    (:user/xp (get-user-by-name db username))\n    (let [{:keys [start-day end-day]} ((get period-interval period) date)\n          rows (get-activities-in-interval db username start-day end-day)]\n                        (calculate-xp-from-rows rows))\n                      )\n  )\n\n\n\n&quot;, :offset 5699, :ns &quot;project.uredno-test&quot;} {:command &quot;(ns project.leaderboard\n  (:require [project.db :as db]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [project.time :as t]\n            [clojure.pprint :refer [print-table]])\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId)))\n\n\n(defn desc [a b] ; nasao sam na guglu kako se sortira od najveceg ka najmanjem.\n  (compare b a))\n\n;leadreboard for all users\n; (db/get-all-users (d/db conn))\n(defn\n  leaderboard\n  \&quot;users Leaderboard by earned XP\&quot;\n  [users]\n  (sort-by :user/xp desc (map first users)))\n\n(defn leaderboard [db period date]\n  (sort-by :user/xp &gt; (map (fn [user]\n                        {:user/username (:user/username user)\n                         :user/xp (db/xp-per-user db (:user/username user) period date)})\n                      (db/get-all-users db))))\n\n\n&quot;, :offset 975, :ns &quot;project.db&quot;} {:command &quot;(ns project.uredno-test\n  (:require [midje.sweet :refer :all]\n            [project.uredno :as u]\n            [project.db :as db]\n            [project.leaderboard :as lb]\n            [datomic.api :as d]\n            [project.connection :refer [conn]]\n            [database.schema :as schema]\n            [database.seed :as seed]\n            [project.system :as sys]\n            )\n  (:import (java.time.temporal TemporalAdjusters)\n           (java.util Date)\n           (java.time ZonedDateTime LocalDate ZoneId)\n           (java.time Instant LocalDate DayOfWeek MonthDay YearMonth ZoneId)))&quot;, :offset 588, :ns &quot;project.leaderboard&quot;} {:command &quot;(let [conn (fresh-conn)\n      _ (db/create-user! conn \&quot;A\&quot;)\n      _ (db/create-user! conn \&quot;B\&quot;)\n      _ (db/create-user! conn \&quot;C\&quot;)\n      _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n      _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n      _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n      lb (lb/leaderboard (d/db conn) :daily (LocalDate/now))\n      ]\n  lb)&quot;, :offset 356, :ns &quot;project.uredno-test&quot;} {:command &quot;(let [conn (fresh-conn)\n      _ (db/create-user! conn \&quot;A\&quot;)\n      _ (db/create-user! conn \&quot;B\&quot;)\n      _ (db/create-user! conn \&quot;C\&quot;)\n      _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n      _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n      _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n      lb (lb/leaderboard (d/db conn) :daily (LocalDate/now))\n      ]\n  (map :user/xp lb))&quot;, :offset 371, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;leaderboard sort users by xp desc\&quot;\n      (let [conn (fresh-conn)\n            _ (db/create-user! conn \&quot;A\&quot;)\n            _ (db/create-user! conn \&quot;B\&quot;)\n            _ (db/create-user! conn \&quot;C\&quot;)\n            _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n            _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n            _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n            lb (lb/leaderboard (d/db conn) :daily (LocalDate/now))\n            ]\n        (map :user/xp lb))\n      =&gt; [\&quot;B\&quot; \&quot;A\&quot; \&quot;C\&quot;])&quot;, :offset 497, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;leaderboard sort users by xp desc\&quot;\n      (let [conn (fresh-conn)\n            _ (db/create-user! conn \&quot;A\&quot;)\n            _ (db/create-user! conn \&quot;B\&quot;)\n            _ (db/create-user! conn \&quot;C\&quot;)\n            _ (db/add-activity! conn \&quot;A\&quot; :training 60 1)\n            _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n            _ (db/add-activity! conn \&quot;C\&quot; :training 60 2)\n            lb (lb/leaderboard (d/db conn) :daily (LocalDate/now))\n            ]\n        (map :user/username lb))\n      =&gt; [\&quot;B\&quot; \&quot;A\&quot; \&quot;C\&quot;])&quot;, :offset 503, :ns &quot;project.uredno-test&quot;} {:command &quot;(fact \&quot;leaderboard sort users by xp desc\&quot;\n      (let [conn (fresh-conn)\n            _ (db/create-user! conn \&quot;A\&quot;)\n            _ (db/create-user! conn \&quot;B\&quot;)\n            _ (db/create-user! conn \&quot;C\&quot;)\n            _ (db/add-activity! conn \&quot;A\&quot; :training 60 2)\n            _ (db/add-activity! conn \&quot;B\&quot; :training 60 3)\n            _ (db/add-activity! conn \&quot;C\&quot; :training 60 1)\n            lb (lb/leaderboard (d/db conn) :daily (LocalDate/now))\n            ]\n        (map :user/username lb))\n      =&gt; [\&quot;B\&quot; \&quot;A\&quot; \&quot;C\&quot;])&quot;, :offset 503, :ns &quot;project.uredno-test&quot;}], :remote []}}</component>
  <component name="RunManager">
    <configuration default="true" type="Babashka" factoryName="BabashkaLocalRepl" activateToolWindowBeforeRun="false">
      <setting name="displayName" value="" />
      <setting name="bbPath" value="" />
      <setting name="parameters" value="" />
      <option name="PARENT_ENVS" value="true" />
      <setting name="workingDir" value="" />
      <setting name="focusEditor" value="false" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
    <configuration name="REPL for ProjectV1" type="ClojureREPL" factoryName="Local" activateToolWindowBeforeRun="false">
      <option name="configVersion" value="1" />
      <option name="displayName" value="REPL for ProjectV1" />
      <option name="execution" value="LEININGEN" />
      <module name="ProjectV1" />
      <option name="options" />
      <option name="profiles" />
      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
      <method v="2" />
    </configuration>
    <configuration default="true" type="ClojureREPL" factoryName="Local" activateToolWindowBeforeRun="false">
      <option name="configVersion" value="1" />
      <option name="options" />
      <option name="profiles" />
      <method v="2" />
    </configuration>
    <configuration default="true" type="ClojureREPL" factoryName="Remote" activateToolWindowBeforeRun="false">
      <setting name="displayName" value="" />
      <setting name="host" value="" />
      <setting name="port" value="0" />
      <setting name="replType" value="SOCKET" />
      <setting name="configType" value="SPECIFY" />
      <setting name="replPortFileType" value="STANDARD" />
      <setting name="customPortFile" value="" />
      <setting name="fixLineNumbers" value="false" />
      <setting name="useHeartbeat" value="true" />
      <setting name="focusEditor" value="false" />
      <setting name="urlFile" value="" />
      <method v="2" />
    </configuration>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-fbdcb00ec9e3-intellij.indexing.shared.core-IU-251.25410.129" />
        <option value="bundled-js-predefined-d6986cc7102b-6a121458b545-JavaScript-IU-251.25410.129" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="4d338447-6f3a-43e8-ab8c-95e214f36644" name="Changes" comment="" />
      <created>1767121985479</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1767121985479</updated>
      <workItem from="1767121986415" duration="3674000" />
      <workItem from="1767181139032" duration="1494000" />
      <workItem from="1767351215899" duration="6476000" />
      <workItem from="1767379148928" duration="2673000" />
      <workItem from="1767381868455" duration="67000" />
      <workItem from="1767472762290" duration="1088000" />
      <workItem from="1767537145030" duration="11000" />
      <workItem from="1767625268145" duration="5102000" />
      <workItem from="1767694847080" duration="18149000" />
      <workItem from="1767804228503" duration="9080000" />
      <workItem from="1767892649731" duration="8974000" />
      <workItem from="1767906416609" duration="6067000" />
      <workItem from="1767958972899" duration="595000" />
      <workItem from="1768070963735" duration="14388000" />
      <workItem from="1768129866250" duration="9988000" />
      <workItem from="1768149678456" duration="13189000" />
      <workItem from="1768171748332" duration="36000" />
      <workItem from="1768403682096" duration="4369000" />
      <workItem from="1768474526888" duration="8177000" />
      <workItem from="1768491610839" duration="3377000" />
      <workItem from="1768587661011" duration="10613000" />
      <workItem from="1768638813832" duration="14723000" />
      <workItem from="1768662775460" duration="5330000" />
      <workItem from="1768736915225" duration="291000" />
      <workItem from="1768771507620" duration="5024000" />
    </task>
    <task id="LOCAL-00001" summary="Ucitan je Datomic, sad vezbam koriscenje kroz dokumentaciju">
      <option name="closed" value="true" />
      <created>1767125847824</created>
      <option name="number" value="00001" />
      <option name="presentableId" value="LOCAL-00001" />
      <option name="project" value="LOCAL" />
      <updated>1767125847824</updated>
    </task>
    <task id="LOCAL-00002" summary="Dodate neke default funkcije koje rade sa bazom u datomicu">
      <option name="closed" value="true" />
      <created>1767367199446</created>
      <option name="number" value="00002" />
      <option name="presentableId" value="LOCAL-00002" />
      <option name="project" value="LOCAL" />
      <updated>1767367199446</updated>
    </task>
    <task id="LOCAL-00003" summary="Uradjene kreiraj korisnika i dodaj xp u bazi">
      <option name="closed" value="true" />
      <created>1767381886292</created>
      <option name="number" value="00003" />
      <option name="presentableId" value="LOCAL-00003" />
      <option name="project" value="LOCAL" />
      <updated>1767381886292</updated>
    </task>
    <task id="LOCAL-00004" summary="Uradjene kreiraj korisnika i dodaj xp u bazi 2">
      <option name="closed" value="true" />
      <created>1767483540530</created>
      <option name="number" value="00004" />
      <option name="presentableId" value="LOCAL-00004" />
      <option name="project" value="LOCAL" />
      <updated>1767483540530</updated>
    </task>
    <task id="LOCAL-00005" summary="Provezbana funkcija add-xp">
      <option name="closed" value="true" />
      <created>1767634382925</created>
      <option name="number" value="00005" />
      <option name="presentableId" value="LOCAL-00005" />
      <option name="project" value="LOCAL" />
      <updated>1767634382925</updated>
    </task>
    <task id="LOCAL-00006" summary="transakciona funkcija koja dodaje xp useru, kreirana sema aktivnosti/event koje user izvrsava da bi dobio xp, &#10;kreirana sema tipa aktivnosti koja ima main tip aktivnosti.&#10;odvajam kod u dva paketa db i main paket, &#10;i db.clj u dva fajla schema.clj, seed.clj gde cu imati back ako mi se nesto zezne kao na primer da ubacim dva worka...">
      <option name="closed" value="true" />
      <created>1767734960862</created>
      <option name="number" value="00006" />
      <option name="presentableId" value="LOCAL-00006" />
      <option name="project" value="LOCAL" />
      <updated>1767734960862</updated>
    </task>
    <task id="LOCAL-00007" summary="transakciona funkcija koja dodaje xp useru, kreirana sema aktivnosti/event koje user izvrsava da bi dobio xp, &#10;kreirana sema tipa aktivnosti koja ima main tip aktivnosti.&#10;odvajam kod u dva paketa db i main paket, &#10;i db.clj u dva fajla schema.clj, seed.clj gde cu imati back ako mi se nesto zezne kao na primer da ubacim dva worka...">
      <option name="closed" value="true" />
      <created>1767734966394</created>
      <option name="number" value="00007" />
      <option name="presentableId" value="LOCAL-00007" />
      <option name="project" value="LOCAL" />
      <updated>1767734966394</updated>
    </task>
    <task id="LOCAL-00008" summary="Uh, datomic je malo naporan iskreno, ali zanimljiv jer je sve kao u clojuru. Odvojio sam scheme i seed, pohvatao sam fazon sa transakcijama, i kako se sta pise">
      <option name="closed" value="true" />
      <created>1767742945250</created>
      <option name="number" value="00008" />
      <option name="presentableId" value="LOCAL-00008" />
      <option name="project" value="LOCAL" />
      <updated>1767742945250</updated>
    </task>
    <task id="LOCAL-00009" summary="Kreirana funkcija activity/add, sustina app, na osnovu parametara se izracuna xp za odredjenu aktivnost">
      <option name="closed" value="true" />
      <created>1767812289892</created>
      <option name="number" value="00009" />
      <option name="presentableId" value="LOCAL-00009" />
      <option name="project" value="LOCAL" />
      <updated>1767812289893</updated>
    </task>
    <task id="LOCAL-00010" summary="Fixed add-activity-tx,&#10;user-activities -&gt; query for finding all activities of one user">
      <option name="closed" value="true" />
      <created>1767902122657</created>
      <option name="number" value="00010" />
      <option name="presentableId" value="LOCAL-00010" />
      <option name="project" value="LOCAL" />
      <updated>1767902122657</updated>
    </task>
    <task id="LOCAL-00011" summary="Daily activities by user - list of every activity done in one day.&#10;Daily-xp - user can be put in leaderboard to compete and compare daily activities with other people.">
      <option name="closed" value="true" />
      <created>1767915212637</created>
      <option name="number" value="00011" />
      <option name="presentableId" value="LOCAL-00011" />
      <option name="project" value="LOCAL" />
      <updated>1767915212637</updated>
    </task>
    <task id="LOCAL-00012" summary="Daily, Weekly and Monthly activities and xp per user">
      <option name="closed" value="true" />
      <created>1768083937606</created>
      <option name="number" value="00012" />
      <option name="presentableId" value="LOCAL-00012" />
      <option name="project" value="LOCAL" />
      <updated>1768083937606</updated>
    </task>
    <task id="LOCAL-00013" summary="Daily, Weekly and Monthly activities and xp per user">
      <option name="closed" value="true" />
      <created>1768085174478</created>
      <option name="number" value="00013" />
      <option name="presentableId" value="LOCAL-00013" />
      <option name="project" value="LOCAL" />
      <updated>1768085174478</updated>
    </task>
    <task id="LOCAL-00014" summary="Fixing old code, erasing and moving unnecessary and outdated functions. &#10;Setting up better architecture, more readable">
      <option name="closed" value="true" />
      <created>1768162612523</created>
      <option name="number" value="00014" />
      <option name="presentableId" value="LOCAL-00014" />
      <option name="project" value="LOCAL" />
      <updated>1768162612523</updated>
    </task>
    <task id="LOCAL-00015" summary="Testing of malli validation">
      <option name="closed" value="true" />
      <created>1768165269540</created>
      <option name="number" value="00015" />
      <option name="presentableId" value="LOCAL-00015" />
      <option name="project" value="LOCAL" />
      <updated>1768165269540</updated>
    </task>
    <task id="LOCAL-00016" summary="Malli validation, validate! function">
      <option name="closed" value="true" />
      <created>1768167032069</created>
      <option name="number" value="00016" />
      <option name="presentableId" value="LOCAL-00016" />
      <option name="project" value="LOCAL" />
      <updated>1768167032069</updated>
    </task>
    <task id="LOCAL-00017" summary="Validation of transaction function add-activity and create user">
      <option name="closed" value="true" />
      <created>1768169307460</created>
      <option name="number" value="00017" />
      <option name="presentableId" value="LOCAL-00017" />
      <option name="project" value="LOCAL" />
      <updated>1768169307460</updated>
    </task>
    <task id="LOCAL-00018" summary="Leaderboard for one day, week and month">
      <option name="closed" value="true" />
      <created>1768495590013</created>
      <option name="number" value="00018" />
      <option name="presentableId" value="LOCAL-00018" />
      <option name="project" value="LOCAL" />
      <updated>1768495590013</updated>
    </task>
    <task id="LOCAL-00019" summary="Leaderboard finito">
      <option name="closed" value="true" />
      <created>1768592793347</created>
      <option name="number" value="00019" />
      <option name="presentableId" value="LOCAL-00019" />
      <option name="project" value="LOCAL" />
      <updated>1768592793347</updated>
    </task>
    <task id="LOCAL-00020" summary="Leaderboard finito 2, merged daily, weekly, monthly leaderboard function in one function, all time leaderboard is still by itself">
      <option name="closed" value="true" />
      <created>1768600694449</created>
      <option name="number" value="00020" />
      <option name="presentableId" value="LOCAL-00020" />
      <option name="project" value="LOCAL" />
      <updated>1768600694449</updated>
    </task>
    <task id="LOCAL-00021" summary="Leaderboard finito 3, i merged even all-time in default leaderboard fn, so now code is clearer and less messy. Deleted unnecessary fucntion i no longer use. Added 3 tests for 2 for adding activity and 1 for leaderboard.">
      <option name="closed" value="true" />
      <created>1768661297153</created>
      <option name="number" value="00021" />
      <option name="presentableId" value="LOCAL-00021" />
      <option name="project" value="LOCAL" />
      <updated>1768661297153</updated>
    </task>
    <option name="localTasksCounter" value="22" />
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
  <component name="Vcs.Log.Tabs.Properties">
    <option name="TAB_STATES">
      <map>
        <entry key="MAIN">
          <value>
            <State />
          </value>
        </entry>
      </map>
    </option>
  </component>
  <component name="VcsManagerConfiguration">
    <MESSAGE value="Ucitan je Datomic, sad vezbam koriscenje kroz dokumentaciju" />
    <MESSAGE value="Dodate neke default funkcije koje rade sa bazom u datomicu" />
    <MESSAGE value="Uradjene kreiraj korisnika i dodaj xp u bazi" />
    <MESSAGE value="Uradjene kreiraj korisnika i dodaj xp u bazi 2" />
    <MESSAGE value="Provezbana funkcija add-xp" />
    <MESSAGE value="transakciona funkcija koja dodaje xp useru, kreirana sema aktivnosti/event koje user izvrsava da bi dobio xp, &#10;kreirana sema tipa aktivnosti koja ima main tip aktivnosti" />
    <MESSAGE value="transakciona funkcija koja dodaje xp useru, kreirana sema aktivnosti/event koje user izvrsava da bi dobio xp, &#10;kreirana sema tipa aktivnosti koja ima main tip aktivnosti.&#10;odvajam kod u dva paketa db i main paket, &#10;i db.clj u dva fajla schema.clj, seed.clj gde cu imati back ako mi se nesto zezne kao na primer da ubacim dva worka..." />
    <MESSAGE value="Uh, datomic je malo naporan iskreno, ali zanimljiv jer je sve kao u clojuru. Odvojio sam scheme i seed, pohvatao sam fazon sa transakcijama, i kako se sta pise" />
    <MESSAGE value="Kreirana funkcija activity/add, sustina app, na osnovu parametara se izracuna xp za odredjenu aktivnost" />
    <MESSAGE value="Fixed add-activity-tx,&#10;user-activities -&gt; query for finding all activities of one user" />
    <MESSAGE value="Daily activities by user - list of every activity done in one day.&#10;Daily-xp - user can be put in leaderboard to compete and compare daily activities with other people." />
    <MESSAGE value="Daily, Weekly and Monthly activities and xp per user" />
    <MESSAGE value="Fixing old code, erasing and moving unnecessary and outdated functions. &#10;Setting up better architecture, more readable" />
    <MESSAGE value="Testing of malli validation" />
    <MESSAGE value="Malli validation, validate! function" />
    <MESSAGE value="Validation of transaction function add-activity and create user" />
    <MESSAGE value="Leaderboard for one day, week and month" />
    <MESSAGE value="Leaderboard finito" />
    <MESSAGE value="Leaderboard finito 2, merged daily, weekly, monthly leaderboard function in one function, all time leaderboard is still by itself" />
    <MESSAGE value="Leaderboard finito 3, i merged even all-time in default leaderboard fn, so now code is clearer and less messy. Deleted unnecessary fucntion i no longer use. Added 3 tests for 2 for adding activity and 1 for leaderboard." />
    <option name="LAST_COMMIT_MESSAGE" value="Leaderboard finito 3, i merged even all-time in default leaderboard fn, so now code is clearer and less messy. Deleted unnecessary fucntion i no longer use. Added 3 tests for 2 for adding activity and 1 for leaderboard." />
  </component>
</project>