<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="4d338447-6f3a-43e8-ab8c-95e214f36644" name="Changes" comment="Front, can add activity on front, cant delete it, it looks okay">
      <change afterPath="$PROJECT_DIR$/src/web/calendar_tutorial.clj" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/.nrepl-port" beforeDir="false" afterPath="$PROJECT_DIR$/.nrepl-port" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/src/web/server.clj" beforeDir="false" afterPath="$PROJECT_DIR$/src/web/server.clj" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/target/classes/META-INF/maven/ProjectV1/ProjectV1/pom.properties" beforeDir="false" afterPath="$PROJECT_DIR$/target/classes/META-INF/maven/ProjectV1/ProjectV1/pom.properties" afterDir="false" />
      <change beforePath="$PROJECT_DIR$/target/repl-port" beforeDir="false" afterPath="$PROJECT_DIR$/target/repl-port" afterDir="false" />
    </list>
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Clojure Test Namespace" />
        <option value="Clojure Namespace" />
      </list>
    </option>
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
  </component>
  <component name="GitHubPullRequestSearchHistory">{
  &quot;lastFilter&quot;: {
    &quot;state&quot;: &quot;OPEN&quot;,
    &quot;assignee&quot;: &quot;micko112&quot;
  }
}</component>
  <component name="GithubPullRequestsUISettings">{
  &quot;selectedUrlAndAccountId&quot;: {
    &quot;url&quot;: &quot;https://github.com/micko112/ClojureProject.git&quot;,
    &quot;accountId&quot;: &quot;3764571a-842a-40c7-838d-20632f3769b4&quot;
  }
}</component>
  <component name="HighlightingSettingsPerFile">
    <setting file="file://$PROJECT_DIR$/src/project/db.clj" root0="FORCE_HIGHLIGHTING" />
  </component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 5
}</component>
  <component name="ProjectId" id="37ZsZpPnuy4tgd50LQGXH7cfGlR" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent">{
  &quot;keyToString&quot;: {
    &quot;Clojure REPL.REPL for ProjectV1.executor&quot;: &quot;Run&quot;,
    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
    &quot;SHARE_PROJECT_CONFIGURATION_FILES&quot;: &quot;true&quot;,
    &quot;clojure.test.Test project.api-test/delta-test.executor&quot;: &quot;Run&quot;,
    &quot;clojure.test.Test project.api-test/leaderboard-rank-ties-test.executor&quot;: &quot;Run&quot;,
    &quot;cursive.last.file.extension.C\\:/xampp/htdocs/Clojure/Clojure for Brave and True/ProjectV1/src&quot;: &quot;clj&quot;,
    &quot;cursive.last.file.extension.C\\:/xampp/htdocs/Clojure/Clojure for Brave and True/ProjectV1/test&quot;: &quot;clj&quot;,
    &quot;git-widget-placeholder&quot;: &quot;main&quot;,
    &quot;last_opened_file_path&quot;: &quot;C:/xampp/htdocs/Clojure/Clojure for Brave and True/ProjectV1/project.clj&quot;,
    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
    &quot;settings.editor.selected.configurable&quot;: &quot;preferences.lookFeel&quot;,
    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
  },
  &quot;keyToStringList&quot;: {
    &quot;GitStage.ChangesTree.GroupingKeys&quot;: [
      &quot;directory&quot;,
      &quot;module&quot;,
      &quot;repository&quot;
    ]
  }
}</component>
  <component name="RecentsManager">
    <key name="MoveFile.RECENT_KEYS">
      <recent name="C:\xampp\htdocs\Clojure\Clojure for Brave and True\ProjectV1\src\playground" />
    </key>
  </component>
  <component name="ReplState" timestamp="1770058142797">{:repl-history {:ide [], :local [{:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; z-index: 20; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n        .activity-block {  background: #2c3e50;  color: white; padding: 8px 12px;  border-radius: 6px;  z-index: 5;  display: flex;  align-items: center;}\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: auto; z-index: 2;\&quot;}]\n\n     (for [a activities]\n       (activity-&gt;block a))\n\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13198, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: auto; z-index: 2;\&quot;}]\n\n     (for [a activities]\n       (activity-&gt;block a))\n\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13043, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: auto; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13084, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13260, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot (str \&quot;position: absolute; top: \&quot; (* hour 60) \&quot;px; left: 0; right: 0; height: 60px; \n                      border-top: 1px solid #eee; cursor: pointer; z-index: 1;\&quot;)\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13425, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot {:style (str \&quot;position: absolute; top: \&quot; (* hour 60) \&quot;px; left: 0; right: 0; height: 60px; \n                      border-top: 1px solid #eee; cursor: pointer; z-index: 1;\&quot;)}\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13434, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot \n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          :style (str \&quot;position: absolute; top: \&quot; (* hour 60) \&quot;px; left: 0; right: 0; height: 60px; \n                      border-top: 1px solid #eee; cursor: pointer; z-index: 1;\&quot;)}]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13443, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13271, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 5; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 10; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 200;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 20; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; z-index: 10;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13249, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 1000;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 30; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13327, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 1000;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 30; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper {:style \&quot;position: relative; height: 70vh; overflow-y: auto; border: 1px solid #ccc;\&quot;}\n    [:div.calendar-scroll {:style \&quot;position: relative; height: 1440px;\&quot;}\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13358, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 1000;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 30; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper \n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13225, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n        .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n        .hour-slot:hover { background-color: #fcfcfc; }\n\n        /* FORMA U SLOTU */\n        .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 1000;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n        top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 30; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper \n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center; position: relative; z-index: 100;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13225, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13453, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:script \&quot;\n      document.addEventListener('DOMContentLoaded', function() {\n        // Function to handle form visibility\n        function handleFormVisibility() {\n          const formContainer = document.querySelector('.slot-form-container');\n          const calendarScroll = document.querySelector('.calendar-scroll');\n          const allHourRows = document.querySelectorAll('.hour-row');\n          const allHourSlots = document.querySelectorAll('.hour-slot');\n\n          if (formContainer) {\n            // Form is visible - disable pointer events on all hour-rows/slots except the one with form\n            allHourRows.forEach(row =&gt; {\n              if (!row.contains(formContainer)) {\n                row.style.pointerEvents = 'none';\n                row.style.zIndex = '1';\n              } else {\n                row.style.pointerEvents = 'auto';\n                row.style.zIndex = '9999';\n              }\n            });\n            allHourSlots.forEach(slot =&gt; {\n              if (!slot.contains(formContainer)) {\n                slot.style.pointerEvents = 'none';\n                slot.style.zIndex = '1';\n              } else {\n                slot.style.pointerEvents = 'auto';\n                slot.style.zIndex = '9999';\n              }\n            });\n          } else {\n            // Form is not visible - re-enable all pointer events\n            allHourRows.forEach(row =&gt; {\n              row.style.pointerEvents = '';\n              row.style.zIndex = '';\n            });\n            allHourSlots.forEach(slot =&gt; {\n              slot.style.pointerEvents = '';\n              slot.style.zIndex = '';\n            });\n          }\n        }\n\n        // Use MutationObserver to watch for form appearance/disappearance\n        const observer = new MutationObserver(function(mutations) {\n          handleFormVisibility();\n        });\n\n        // Observe the calendar-scroll for changes\n        const calendarScroll = document.querySelector('.calendar-scroll');\n        if (calendarScroll) {\n          observer.observe(calendarScroll, {\n            childList: true,\n            subtree: true\n          });\n        }\n\n        // Also listen to HTMX events\n        document.body.addEventListener('htmx:afterSwap', handleFormVisibility);\n        document.body.addEventListener('htmx:afterSettle', handleFormVisibility);\n\n        // Initial check\n        handleFormVisibility();\n      });\n    \&quot;]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000 !important;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto !important;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form-container * { pointer-events: auto !important; position: relative; z-index: 10001 !important; }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 15994, :ns &quot;project.core&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:script \&quot;\n      document.addEventListener('DOMContentLoaded', function() {\n        // Function to handle form visibility\n        function handleFormVisibility() {\n          const formContainer = document.querySelector('.slot-form-container');\n          const calendarScroll = document.querySelector('.calendar-scroll');\n          const allHourRows = document.querySelectorAll('.hour-row');\n          const allHourSlots = document.querySelectorAll('.hour-slot');\n          \n          if (formContainer) {\n            // Form is visible - disable pointer events on all hour-rows/slots except the one with form\n            allHourRows.forEach(row =&gt; {\n              if (!row.contains(formContainer)) {\n                row.style.pointerEvents = 'none';\n                row.style.zIndex = '1';\n              } else {\n                row.style.pointerEvents = 'auto';\n                row.style.zIndex = '9999';\n              }\n            });\n            allHourSlots.forEach(slot =&gt; {\n              if (!slot.contains(formContainer)) {\n                slot.style.pointerEvents = 'none';\n                slot.style.zIndex = '1';\n              } else {\n                slot.style.pointerEvents = 'auto';\n                slot.style.zIndex = '9999';\n              }\n            });\n          } else {\n            // Form is not visible - re-enable all pointer events\n            allHourRows.forEach(row =&gt; {\n              row.style.pointerEvents = '';\n              row.style.zIndex = '';\n            });\n            allHourSlots.forEach(slot =&gt; {\n              slot.style.pointerEvents = '';\n              slot.style.zIndex = '';\n            });\n          }\n        }\n        \n        // Use MutationObserver to watch for form appearance/disappearance\n        const observer = new MutationObserver(function(mutations) {\n          handleFormVisibility();\n        });\n        \n        // Observe the calendar-scroll for changes\n        const calendarScroll = document.querySelector('.calendar-scroll');\n        if (calendarScroll) {\n          observer.observe(calendarScroll, {\n            childList: true,\n            subtree: true\n          });\n        }\n        \n        // Also listen to HTMX events\n        document.body.addEventListener('htmx:afterSwap', handleFormVisibility);\n        document.body.addEventListener('htmx:afterSettle', handleFormVisibility);\n        \n        // Initial check\n        handleFormVisibility();\n      });\n    \&quot;]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n \n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n \n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n \n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n \n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n \n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n \n         /* FORMA U SLOTU */\n         .slot-form-container { \n             padding: 16px; \n             background: white; \n             border-radius: 12px; \n             z-index: 10000 !important;\n             box-shadow: 0 8px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08); \n             border: 1px solid #e8eaed; \n             position: absolute;\n             top: 8px; \n             left: 8px; \n             width: 580px; \n             animation: fadeIn 0.2s ease-out; \n             pointer-events: auto !important;\n             isolation: isolate; \n             transform: translateZ(0);\n         }\n         .slot-form-container * { pointer-events: auto !important; position: relative; z-index: 10001 !important; }\n         .slot-form { \n             display: flex; \n             gap: 12px; \n             flex-wrap: wrap; \n             flex-direction: column; \n         }\n         .slot-form-row { \n             display: flex; \n             gap: 12px; \n             width: 100%; \n             align-items: stretch;\n         }\n         .slot-form-row:last-child {\n             justify-content: space-between;\n         }\n         .slot-form-row:last-child select {\n             flex: 0 1 auto;\n             min-width: 140px;\n         }\n         .slot-form-row:last-child button {\n             flex: 0 0 auto;\n         }\n         .slot-form select { \n             padding: 10px 14px; \n             border: 1.5px solid #e0e0e0; \n             border-radius: 8px; \n             background: #fff; \n             flex: 1; \n             font-size: 14px; \n             font-weight: 500;\n             color: #333;\n             cursor: pointer;\n             transition: all 0.2s ease;\n             outline: none;\n             appearance: none;\n             background-image: url(\\\&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E\\\&quot;);\n             background-repeat: no-repeat;\n             background-position: right 12px center;\n             padding-right: 36px;\n         }\n         .slot-form select:hover { \n             border-color: #2c3e50; \n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.1);\n         }\n         .slot-form select:focus { \n             border-color: #2c3e50; \n             box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);\n             outline: none;\n         }\n         .slot-form button { \n             padding: 10px 24px; \n             background: #2c3e50; \n             color: white; \n             border: none; \n             border-radius: 8px; \n             cursor: pointer; \n             font-weight: 600; \n             font-size: 14px;\n             transition: all 0.2s ease;\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);\n             min-width: 100px;\n         }\n         .slot-form button:hover { \n             background: #34495e; \n             box-shadow: 0 4px 8px rgba(44, 62, 80, 0.3);\n             transform: translateY(-1px);\n         }\n         .slot-form button:active {\n             transform: translateY(0);\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);\n         }\n \n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n \n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 18156, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:script \&quot;\n      document.addEventListener('DOMContentLoaded', function() {\n        // Function to handle form visibility\n        function handleFormVisibility() {\n          const formContainer = document.querySelector('.slot-form-container');\n          const calendarScroll = document.querySelector('.calendar-scroll');\n          const allHourRows = document.querySelectorAll('.hour-row');\n          const allHourSlots = document.querySelectorAll('.hour-slot');\n          \n          if (formContainer) {\n            // Form is visible - disable pointer events on all hour-rows/slots except the one with form\n            allHourRows.forEach(row =&gt; {\n              if (!row.contains(formContainer)) {\n                row.style.pointerEvents = 'none';\n                row.style.zIndex = '1';\n              } else {\n                row.style.pointerEvents = 'auto';\n                row.style.zIndex = '9999';\n              }\n            });\n            allHourSlots.forEach(slot =&gt; {\n              if (!slot.contains(formContainer)) {\n                slot.style.pointerEvents = 'none';\n                slot.style.zIndex = '1';\n              } else {\n                slot.style.pointerEvents = 'auto';\n                slot.style.zIndex = '9999';\n              }\n            });\n          } else {\n            // Form is not visible - re-enable all pointer events\n            allHourRows.forEach(row =&gt; {\n              row.style.pointerEvents = '';\n              row.style.zIndex = '';\n            });\n            allHourSlots.forEach(slot =&gt; {\n              slot.style.pointerEvents = '';\n              slot.style.zIndex = '';\n            });\n          }\n        }\n        \n        // Use MutationObserver to watch for form appearance/disappearance\n        const observer = new MutationObserver(function(mutations) {\n          handleFormVisibility();\n        });\n        \n        // Observe the calendar-scroll for changes\n        const calendarScroll = document.querySelector('.calendar-scroll');\n        if (calendarScroll) {\n          observer.observe(calendarScroll, {\n            childList: true,\n            subtree: true\n          });\n        }\n        \n        // Also listen to HTMX events\n        document.body.addEventListener('htmx:afterSwap', handleFormVisibility);\n        document.body.addEventListener('htmx:afterSettle', handleFormVisibility);\n        \n        // Initial check\n        handleFormVisibility();\n      });\n    \&quot;]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n \n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n \n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n \n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n \n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n \n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n \n         /* FORMA U SLOTU */\n         .slot-form-container {\n             padding: 16px;\n             background: white;\n             border-radius: 12px;\n             z-index: 10000 !important;\n             box-shadow: 0 8px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08);\n             border: 1px solid #e8eaed;\n             position: absolute;\n             top: 8px;\n             left: 8px;\n             width: 580px;\n             animation: fadeIn 0.2s ease-out;\n             pointer-events: auto !important;\n             isolation: isolate;\n             transform: translateZ(0);\n         }\n         .slot-form-container * { pointer-events: auto !important; position: relative; z-index: 10001 !important; }\n         .slot-form {\n             display: flex;\n             gap: 12px;\n             flex-wrap: wrap;\n             flex-direction: column;\n         }\n         .slot-form-row {\n             display: flex;\n             gap: 12px;\n             width: 100%;\n             align-items: stretch;\n         }\n         .slot-form-row:last-child select {\n             flex: 0 1 auto;\n             min-width: 140px;\n             max-width: 200px;\n         }\n         .slot-form-row:last-child button {\n             flex: 0 0 auto;\n             margin-left: auto;\n         }\n         .slot-form select {\n             padding: 10px 14px;\n             border: 1.5px solid #e0e0e0;\n             border-radius: 8px;\n             background: #fff;\n             flex: 1;\n             font-size: 14px;\n             font-weight: 500;\n             color: #333;\n             cursor: pointer;\n             transition: all 0.2s ease;\n             outline: none;\n             appearance: none;\n             background-image: url(\\\&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E\\\&quot;);\n             background-repeat: no-repeat;\n             background-position: right 12px center;\n             padding-right: 36px;\n         }\n         .slot-form select:hover {\n             border-color: #2c3e50;\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.1);\n         }\n         .slot-form select:focus {\n             border-color: #2c3e50;\n             box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);\n             outline: none;\n         }\n         .slot-form button {\n             padding: 10px 24px;\n             background: #2c3e50;\n             color: white;\n             border: none;\n             border-radius: 8px;\n             cursor: pointer;\n             font-weight: 600;\n             font-size: 14px;\n             transition: all 0.2s ease;\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);\n             min-width: 100px;\n         }\n         .slot-form button:hover {\n             background: #34495e;\n             box-shadow: 0 4px 8px rgba(44, 62, 80, 0.3);\n             transform: translateY(-1px);\n         }\n         .slot-form button:active {\n             transform: translateY(0);\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);\n         }\n \n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n \n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 18085, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:script \&quot;\n      document.addEventListener('DOMContentLoaded', function() {\n        // Function to handle form visibility\n        function handleFormVisibility() {\n          const formContainer = document.querySelector('.slot-form-container');\n          const calendarScroll = document.querySelector('.calendar-scroll');\n          const allHourRows = document.querySelectorAll('.hour-row');\n          const allHourSlots = document.querySelectorAll('.hour-slot');\n          \n          if (formContainer) {\n            // Form is visible - disable pointer events on all hour-rows/slots except the one with form\n            allHourRows.forEach(row =&gt; {\n              if (!row.contains(formContainer)) {\n                row.style.pointerEvents = 'none';\n                row.style.zIndex = '1';\n              } else {\n                row.style.pointerEvents = 'auto';\n                row.style.zIndex = '9999';\n              }\n            });\n            allHourSlots.forEach(slot =&gt; {\n              if (!slot.contains(formContainer)) {\n                slot.style.pointerEvents = 'none';\n                slot.style.zIndex = '1';\n              } else {\n                slot.style.pointerEvents = 'auto';\n                slot.style.zIndex = '9999';\n              }\n            });\n          } else {\n            // Form is not visible - re-enable all pointer events\n            allHourRows.forEach(row =&gt; {\n              row.style.pointerEvents = '';\n              row.style.zIndex = '';\n            });\n            allHourSlots.forEach(slot =&gt; {\n              slot.style.pointerEvents = '';\n              slot.style.zIndex = '';\n            });\n          }\n        }\n        \n        // Use MutationObserver to watch for form appearance/disappearance\n        const observer = new MutationObserver(function(mutations) {\n          handleFormVisibility();\n        });\n        \n        // Observe the calendar-scroll for changes\n        const calendarScroll = document.querySelector('.calendar-scroll');\n        if (calendarScroll) {\n          observer.observe(calendarScroll, {\n            childList: true,\n            subtree: true\n          });\n        }\n        \n        // Also listen to HTMX events\n        document.body.addEventListener('htmx:afterSwap', handleFormVisibility);\n        document.body.addEventListener('htmx:afterSettle', handleFormVisibility);\n        \n        // Initial check\n        handleFormVisibility();\n      });\n    \&quot;]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container {\n             padding: 16px;\n             background: white;\n             border-radius: 12px;\n             z-index: 10000 !important;\n             box-shadow: 0 8px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08);\n             border: 1px solid #e8eaed;\n             position: absolute;\n             top: 8px;\n             left: 8px;\n             width: 580px;\n             animation: fadeIn 0.2s ease-out;\n             pointer-events: auto !important;\n             isolation: isolate;\n             transform: translateZ(0);\n         }\n         .slot-form-container * { pointer-events: auto !important; position: relative; z-index: 10001 !important; }\n         .slot-form {\n             display: flex;\n             gap: 12px;\n             flex-wrap: wrap;\n             flex-direction: column;\n         }\n         .slot-form-row {\n             display: flex;\n             gap: 12px;\n             width: 100%;\n             align-items: stretch;\n         }\n         .slot-form-row:last-child select {\n             flex: 0 1 auto;\n             min-width: 140px;\n             max-width: 200px;\n         }\n         .slot-form-row:last-child button {\n             flex: 0 0 auto;\n             margin-left: auto;\n         }\n         .slot-form select {\n             padding: 10px 14px;\n             border: 1.5px solid #e0e0e0;\n             border-radius: 8px;\n             background: #fff;\n             flex: 1;\n             font-size: 14px;\n             font-weight: 500;\n             color: #333;\n             cursor: pointer;\n             transition: all 0.2s ease;\n             outline: none;\n             appearance: none;\n             background-image: url(\\\&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E\\\&quot;);\n             background-repeat: no-repeat;\n             background-position: right 12px center;\n             padding-right: 36px;\n         }\n         .slot-form select:hover {\n             border-color: #2c3e50;\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.1);\n         }\n         .slot-form select:focus {\n             border-color: #2c3e50;\n             box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);\n             outline: none;\n         }\n         .slot-form button {\n             padding: 10px 24px;\n             background: #2c3e50;\n             color: white;\n             border: none;\n             border-radius: 8px;\n             cursor: pointer;\n             font-weight: 600;\n             font-size: 14px;\n             transition: all 0.2s ease;\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);\n             min-width: 100px;\n         }\n         .slot-form button:hover {\n             background: #34495e;\n             box-shadow: 0 4px 8px rgba(44, 62, 80, 0.3);\n             transform: translateY(-1px);\n         }\n         .slot-form button:active {\n             transform: translateY(0);\n             box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);\n         }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 18077, :ns &quot;web.server&quot;} {:command &quot;  (ns web.server\n    (:require [ring.adapter.jetty :as jetty]\n              [reitit.ring :as ring]\n              [reitit.ring.middleware.parameters :as parameters]\n              [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n              [hiccup.page :refer [html5]]\n              [hiccup2.core :as h]\n              [project.api :as api]\n              [datomic.api :as d]\n              [project.system :as sys]\n              [clojure.string :as str]\n              [ring.middleware.session :refer [wrap-session]]\n              [cheshire.core :refer :all]\n              )\n    (:import (java.time LocalDate LocalTime Duration ZoneId)\n             (java.time.format DateTimeFormatter)\n             (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n   [:head\n    [:title \&quot;BeBetter\&quot;]\n    [:meta {:charset \&quot;UTF-8\&quot;}]\n    [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n    [:script \&quot;\n      document.addEventListener('DOMContentLoaded', function() {\n        // Function to handle form visibility\n        function handleFormVisibility() {\n          const formContainer = document.querySelector('.slot-form-container');\n          const calendarScroll = document.querySelector('.calendar-scroll');\n          const allHourRows = document.querySelectorAll('.hour-row');\n          const allHourSlots = document.querySelectorAll('.hour-slot');\n          \n          if (formContainer) {\n            // Form is visible - disable pointer events on all hour-rows/slots except the one with form\n            allHourRows.forEach(row =&gt; {\n              if (!row.contains(formContainer)) {\n                row.style.pointerEvents = 'none';\n                row.style.zIndex = '1';\n              } else {\n                row.style.pointerEvents = 'auto';\n                row.style.zIndex = '9999';\n              }\n            });\n            allHourSlots.forEach(slot =&gt; {\n              if (!slot.contains(formContainer)) {\n                slot.style.pointerEvents = 'none';\n                slot.style.zIndex = '1';\n              } else {\n                slot.style.pointerEvents = 'auto';\n                slot.style.zIndex = '9999';\n              }\n            });\n          } else {\n            // Form is not visible - re-enable all pointer events\n            allHourRows.forEach(row =&gt; {\n              row.style.pointerEvents = '';\n              row.style.zIndex = '';\n            });\n            allHourSlots.forEach(slot =&gt; {\n              slot.style.pointerEvents = '';\n              slot.style.zIndex = '';\n            });\n          }\n        }\n        \n        // Use MutationObserver to watch for form appearance/disappearance\n        const observer = new MutationObserver(function(mutations) {\n          handleFormVisibility();\n        });\n        \n        // Observe the calendar-scroll for changes\n        const calendarScroll = document.querySelector('.calendar-scroll');\n        if (calendarScroll) {\n          observer.observe(calendarScroll, {\n            childList: true,\n            subtree: true\n          });\n        }\n        \n        // Also listen to HTMX events\n        document.body.addEventListener('htmx:afterSwap', handleFormVisibility);\n        document.body.addEventListener('htmx:afterSettle', handleFormVisibility);\n        \n        // Initial check\n        handleFormVisibility();\n      });\n    \&quot;]\n    [:style\n     \&quot;\n        /* RESET &amp; BASE */\n        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n        body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n        /* SIDEBAR */\n        .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n        .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n        .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n        .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n        .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n        /* MAIN CONTENT */\n        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n        h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n        /* DAY SELECTOR */\n        #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n        .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n        .day-column:hover { background-color: #f8f9fa; color: #333; }\n        .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n        /* KALENDAR GRID */\n        .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n        .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n           .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\\n        .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\\n        .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\\n        .hour-slot:hover { background-color: #fcfcfc; }\\n        .hour-slot:has(.slot-form-container) { z-index: 9999; }\\n        .hour-row:has(.slot-form-container) { z-index: 9999; }\\n\n\n        /* FORMA U SLOTU */\n        ..slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000 !important;\\n        box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: fixed;\\n        animation: fadeIn 0.2s; pointer-events: auto;\\n        isolation: isolate; transform: translateZ(0); }\\n        .slot-form-container * { pointer-events: auto !important; }\n        .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n        .slot-form-row { display: flex; gap: 8px; width: 100%; }\n        .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n        .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n        .slot-form button:hover { background: #34495e; }\n\n        /* AKTIVNOST BLOK */\n        .activity-block {\n            position: absolute; left: 65px; right: 10px;\n            background: #e3f2fd; border-left: 4px solid #2196f3;\n            color: #1565c0; padding: 8px 12px; border-radius: 4px;\n            font-size: 13px; font-weight: 500;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n            cursor: pointer; transition: transform 0.1s;\n            z-index: 30; pointer-events: auto;\n            display: flex; align-items: center; justify-content: space-between;\n        }\n        .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n        .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n     \&quot;]]\n\n   [:body\n    [:div.sidebar\n     [:div.logo-wrapper\n      [:div.logo \&quot;BeBetter\&quot;]]\n     [:ul.sidebar-menu\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n      [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n    [:main.main-content\n     content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;hour\&quot;\n            :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n  (defn activity-edit-view [id]\n    [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n     [:button {:hx-delete \&quot;/activity\&quot;\n               :hx-vals (generate-string {:id id})\n               :hx-target \&quot;closest .activity-block\&quot;\n               :hx-swap \&quot;outerHTML\&quot;}\n      \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (for [d days]\n                           [:div.day-column\n                            {:class (when (= d day) \&quot;selected\&quot;)\n                             :hx-post \&quot;/select-day\&quot;\n                             :hx-vals (generate-string {:day d})\n                             :hx-target \&quot;#calendar-view\&quot;\n                             :hx-swap \&quot;outerHTML\&quot;}\n                            d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                    :title (:title params)\n                    :duration (Integer/parseInt (:duration params))\n                    :intensity (:intensity params)\n                    :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n  (defn activity-edit-handler [{:keys [params]}]\n    (let [id (:id params)]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body (str (h/html (activity-edit-view id)))})\n    )\n\n  (defn activity-delete-handler [_]\n      {:status 200\n       :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n       :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n   (ring/ring-handler\n    (ring/router [[\&quot;/\&quot; {:get home-page}]\n                  [\&quot;/select-day\&quot; {:post select-day-handler}]\n                  [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                  [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                  [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                  [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                  ]\n                 {:data {:middleware [parameters/parameters-middleware\n                                      wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 16017, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     \&quot;\&quot;\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n \n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n \n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n \n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n \n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n \n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none; }\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n \n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; z-index: 100; position: absolute; top: 5px; left: 5px; width: 300px; animation: fadeIn 0.2s; }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n \n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 20; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n \n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn calendar-view [day]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;none\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}]\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])]\n    ]])\n\n(defn slot-form [day-time]\n  [:form {:hx-post \&quot;/add-activity\&quot;\n          :hx-target \&quot;#calendar-layer\&quot;\n          :hx-swap \&quot;beforeend\&quot;\n          :onclick \&quot;event.stopPropagation()\&quot;\n          :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;}\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;day-time\&quot;\n            :value day-time}]\n\n   [:div {:style \&quot;margin-bottom: 5px;\&quot;}\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]]\n\n   [:div {:style \&quot;margin-bottom: 5px;\&quot;}\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n    ]\n   [:div {:style \&quot;margin-bottom: 5px;\&quot;}\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (h/html (calendar-view day))\n                (h/html [:div {:id \&quot;day-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (h/html (day-column day))]))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [title (:title params)\n        intensity (:intensity params)\n        hour  (Integer/parseInt (:day-time params))\n        duration (Integer/parseInt (:duration params))\n        top (* hour 60)\n        height (* duration 60)\n        id (str (UUID/randomUUID))\n        ]\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (str\n       (h/html\n         [:div.activity-block\n          {:id (str \&quot;act-\&quot; id)\n           :hx-get \&quot;/activity-edit\&quot;\n           :hx-vals (generate-string {:id id})\n           :hx-target \&quot;this\&quot;\n           :hx-swap \&quot;outerHTML\&quot;\n           :style (str \&quot;position:absolute;\&quot; \&quot;top:\&quot; top \&quot;px;\&quot; \&quot;left:4px;\&quot; \&quot;right:4px;\&quot; \&quot;height:\&quot; height \&quot;px;\&quot;\n                       \&quot;background:#2c3e50;\&quot; \&quot;color:white;\&quot; \&quot;border-radius:6px;\&quot; \&quot;padding:6px;\&quot; \&quot;z-index:10;\n                   pointer-events: auto;\&quot;)}\n          (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 12156, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     \n     [:style\n      \&quot;\n          /* OSNOVNI RESET */\n          * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n          body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n          /* SIDEBAR */\n          .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n          .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n          .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n          .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n\n          /* MAIN CONTENT */\n          .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n          h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n          /* DAY SELECTOR */\n          #days-nav { display: flex; gap: 10px; margin-bottom: 20px; }\n          .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; background: white; border: 1px solid #e0e0e0; transition: all 0.2s; }\n          .day-column:hover { background-color: #eef2f6; }\n          .day-column.selected { background-color: #2c3e50; color: white; border-color: #2c3e50; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n\n          /* KALENDAR KONTEJNER */\n          .calendar-scroll { height: 75vh; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; background: white; position: relative; }\n          \n          /* Grid Layout za Kalendar */\n          .calendar-grid { display: flex; min-height: 1440px; position: relative; }\n          \n          /* Leva kolona (Sati) */\n          .time-labels { width: 60px; border-right: 1px solid #f0f0f0; background: #fafafa; flex-shrink: 0; }\n          .time-label { height: 60px; border-bottom: 1px solid #eee; text-align: right; padding-right: 10px; color: #999; font-size: 12px; padding-top: 5px; }\n\n          /* Desna kolona (Sadr≈æaj) */\n          .day-grid { flex-grow: 1; position: relative; }\n\n          /* Slotovi */\n          .hour-slot { height: 60px; border-bottom: 1px solid #f5f5f5; cursor: pointer; position: relative; z-index: 1; }\n          .hour-slot:hover { background-color: #fcfcfc; }\n\n          /* FORMA U SLOTU */\n          .slot-form-container { position: absolute; top: 0; left: 0; right: 0; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); border: 1px solid #ddd; z-index: 100; }\n          .slot-form { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }\n          .slot-form select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }\n          .slot-form button { padding: 8px 16px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; }\n\n          /* AKTIVNOST */\n          .activity-block {\n              position: absolute; left: 5px; right: 10px; \n              background-color: #e3f2fd; border-left: 4px solid #2196f3; \n              color: #1565c0; padding: 5px 10px; border-radius: 4px; \n              font-size: 13px; font-weight: 500; \n              z-index: 20; pointer-events: auto;\n              display: flex; align-items: center; justify-content: space-between;\n              overflow: hidden;\n          }\n       \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn calendar-view [day]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;none\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#calendar-layer {:style \&quot;position:absolute; inset:0; pointer-events: none; z-index: 10;\&quot;}]\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;}]])]\n    ]])\n\n(defn slot-form [day-time]\n  [:form {:hx-post \&quot;/add-activity\&quot;\n          :hx-target \&quot;#calendar-layer\&quot;\n          :hx-swap \&quot;beforeend\&quot;\n          :onclick \&quot;event.stopPropagation()\&quot;\n          :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;}\n   [:input {:type \&quot;hidden\&quot;\n            :name \&quot;day-time\&quot;\n            :value day-time}]\n\n   [:div {:style \&quot;margin-bottom: 5px;\&quot;}\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]]\n\n   [:div {:style \&quot;margin-bottom: 5px;\&quot;}\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n    ]\n   [:div {:style \&quot;margin-bottom: 5px;\&quot;}\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]]\n\n   [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (h/html (calendar-view day))\n                (h/html [:div {:id \&quot;day-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                         (h/html (day-column day))]))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [title (:title params)\n        intensity (:intensity params)\n        hour  (Integer/parseInt (:day-time params))\n        duration (Integer/parseInt (:duration params))\n        top (* hour 60)\n        height (* duration 60)\n        id (str (UUID/randomUUID))\n        ]\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (str\n       (h/html\n         [:div.activity-block\n          {:id (str \&quot;act-\&quot; id)\n           :hx-get \&quot;/activity-edit\&quot;\n           :hx-vals (generate-string {:id id})\n           :hx-target \&quot;this\&quot;\n           :hx-swap \&quot;outerHTML\&quot;\n           :style (str \&quot;position:absolute;\&quot; \&quot;top:\&quot; top \&quot;px;\&quot; \&quot;left:4px;\&quot; \&quot;right:4px;\&quot; \&quot;height:\&quot; height \&quot;px;\&quot;\n                       \&quot;background:#2c3e50;\&quot; \&quot;color:white;\&quot; \&quot;border-radius:6px;\&quot; \&quot;padding:6px;\&quot; \&quot;z-index:10;\n                   pointer-events: auto;\&quot;)}\n          (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 11585, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n \n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n \n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n \n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n \n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n \n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n \n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n \n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n \n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13461, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13500, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13469, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:style (str \&quot;top:\&quot; (* hour 60) \&quot;px;\&quot;\n                                         \&quot;left:80px;\&quot;\n                                         \&quot;position:absolute;\&quot;\n                                         \&quot;pointer-events:auto;\&quot;)\n                             :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13716, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-container\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:style (str \&quot;top:\&quot; (* hour 60) \&quot;px;\&quot;\n                                         \&quot;left:80px;\&quot;\n                                         \&quot;position:absolute;\&quot;\n                                         \&quot;pointer-events:auto;\&quot;)\n                             :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13720, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:style (str \&quot;top:\&quot; (* hour 60) \&quot;px;\&quot;\n                                         \&quot;left:80px;\&quot;\n                                         \&quot;position:absolute;\&quot;\n                                         \&quot;pointer-events:auto;\&quot;)\n                             :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13711, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:style (str \&quot;top:\&quot; (* hour 60) \&quot;px;\&quot;\n                                         \&quot;left:80px;\&quot;\n                                         \&quot;position:absolute;\&quot;\n                                         \&quot;pointer-events:auto;\&quot;)\n                             :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13721, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:style (str \&quot;top:\&quot; (* hour 60) \&quot;px;\&quot;\n                                         \&quot;left:80px;\&quot;\n                                         \&quot;position:absolute;\&quot;\n                                         \&quot;pointer-events:auto;\&quot;)\n                             :onclick \&quot;event.stopPropagation()\&quot;}\n   [:script \&quot;this.parentElement.style.zIndex = '10000';\&quot;]\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     \n     :style \&quot;position: relative; z-index: 10000;\&quot;\n     }\n\n    [:input {:type \&quot;hidden\&quot;\n             :name \&quot;hour\&quot;\n             :value hour}]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;title\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n      [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n      [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n      [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n     [:select {:name \&quot;intensity\&quot; :required true }\n      [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n      [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n      [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n      [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]]\n\n    [:div.slot-form-row\n     [:select {:name \&quot;duration\&quot;}\n      [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n      [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n      [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n      [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n     [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13788, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n\n   ;; --- OVO JE FIX ---\n   ;; Ova skripta se izvr≈°i ƒçim HTMX ubaci formu. \n   ;; Ona naƒëe roditelja (.hour-slot) i digne ga iznad svih ostalih sati.\n   [:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;}\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13650, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n\n   ;; --- OVO JE FIX ---\n   ;; Ova skripta se izvr≈°i ƒçim HTMX ubaci formu. \n   ;; Ona naƒëe roditelja (.hour-slot) i digne ga iznad svih ostalih sati.\n   [:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13594, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n\n   ;; --- OVO JE FIX ---\n   ;; Ova skripta se izvr≈°i ƒçim HTMX ubaci formu.\n   ;; Ona naƒëe roditelja (.hour-slot) i digne ga iznad svih ostalih sati.\n   [:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13598, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   \n  #_[:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13453, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n\n  #_[:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on::after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13599, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n\n  #_[:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13674, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  ;; Kontejner mora biti relative u odnosu na slot, top:0 ga lepi na vrh SLOTA, ne ekrana\n  [:div.slot-form-container\n   {:onclick \&quot;event.stopPropagation()\&quot;\n    :style \&quot;position: absolute; top: 0; left: 0; z-index: 9999; display: block;\&quot;}\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     ;; OVO JE FIX: Kad se zavr≈°i request, bri≈°emo ovaj kontejner\n     :hx-on:htmx:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;}\n\n    ;; Usklaƒëeno ime parametra: hour\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true}\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true}\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot;} \&quot;Save\&quot;]\n    ;; Dugme za otkazivanje koje ruƒçno bri≈°e formu\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 14028, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n\n  #_[:script \&quot;document.currentScript.closest('.hour-slot').style.zIndex = '9999';\&quot;]\n   ;; ------------------\n\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13835, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n          :style (str \&quot;position:absolute; top:\&quot; (* hour 60) \&quot;px; left: 0; right: 0;\n               height:60px; border-top:1px solid #eee; cursor:pointer; \n               position: relative; z-index: 1;\&quot;)\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13989, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; flex-direction: column; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13785, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13782, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;#calendar-form-layer\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13761, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 65px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13745, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container {:onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13746, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div.#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13928, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div.#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13863, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div.#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13864, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13838, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:125px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13867, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:0;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13863, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:60px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot; [\&quot; intensity \&quot;]\&quot;)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13866, :ns &quot;project.core&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:60px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     (str title \&quot;  \&quot; intensity \&quot;  \&quot; duration)]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:button {:hx-delete \&quot;/activity\&quot;\n             :hx-vals (generate-string {:id id})\n             :hx-target \&quot;closest .activity-block\&quot;\n             :hx-swap \&quot;outerHTML\&quot;}\n    \&quot;Delete\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-delete-handler [_]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body \&quot;\&quot;})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 13876, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:60px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     [:div.activity-content\n      (str title \&quot;  \&quot; intensity \&quot;  \&quot; duration \&quot;h\&quot;)]]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div.activity-edit\n   {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:span \&quot;Edit mode\&quot;]\n   [:div.activity-actions\n    [:button {:hx-delete \&quot;/activity\&quot;\n              :hx-vals (generate-string {:id id})\n              :hx-target (str \&quot;#activity-\&quot; id)\n              :hx-swap \&quot;outerHTML\&quot;}]\n    \&quot;Delete\&quot;]\n   [:button\n    {:hx-get \&quot;/activity-view\&quot;\n     :hx-vals (generate-string {:id id})\n     :hx-target \&quot;closest .activity-block\&quot;\n     :hx-swap \&quot;innerHTML\&quot;}\n    \&quot;Cancel\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-view-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)\n        activity (first (filter #(= (:id %) id)\n                                (get-in session [:activities day])))]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html [:div.activity-content\n                         (str (:title activity) \&quot;  \&quot;\n                              (:intensity activity) \&quot;  \&quot;\n                              (:duration activity) \&quot;h\&quot;)]) )}))\n\n(defn activity-delete-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (update-in session [:activities day]\n                         (fn [acts]\n                           (vec (remove #(= (:id %) id) acts))))\n     :body \&quot;\&quot;}\n    )\n  )\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    [\&quot;/activity-view\&quot; {:get activity-view-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 14972, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n          .activity-actions {}\n          .activity-actions button {padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\n          transition: all 0.2s ease; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;}\n          .activity-actions button:first-child {background: #ff4757; color: white;}\n          .activity-actions button:first-child:hover {background: #ff3838; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);}\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:60px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     [:div.activity-content\n      (str title \&quot;  \&quot; intensity \&quot;  \&quot; duration \&quot;h\&quot;)]]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div.activity-edit\n   {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:span \&quot;Edit mode\&quot;]\n   [:div.activity-actions\n    [:button {:hx-delete \&quot;/activity\&quot;\n              :hx-vals (generate-string {:id id})\n              :hx-target (str \&quot;#activity-\&quot; id)\n              :hx-swap \&quot;outerHTML\&quot;}]\n    \&quot;Delete\&quot;]\n   [:button\n    {:hx-get \&quot;/activity-view\&quot;\n     :hx-vals (generate-string {:id id})\n     :hx-target \&quot;closest .activity-block\&quot;\n     :hx-swap \&quot;innerHTML\&quot;}\n    \&quot;Cancel\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-view-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)\n        activity (first (filter #(= (:id %) id)\n                                (get-in session [:activities day])))]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html [:div.activity-content\n                         (str (:title activity) \&quot;  \&quot;\n                              (:intensity activity) \&quot;  \&quot;\n                              (:duration activity) \&quot;h\&quot;)]) )}))\n\n(defn activity-delete-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (update-in session [:activities day]\n                         (fn [acts]\n                           (vec (remove #(= (:id %) id) acts))))\n     :body \&quot;\&quot;}\n    )\n  )\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    [\&quot;/activity-view\&quot; {:get activity-view-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 15477, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n          .activity-actions {}\n          .activity-actions button {padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\n          transition: all 0.2s ease; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;}\n          .activity-actions button:first-child {background: #ff4757; color: white;}\n          .activity-actions button:first-child:hover {background: #ff3838; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);}\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \n      .activity-edit {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    border: none;\n    border-radius: 12px;\n    padding: 1.5rem;\n    margin: 1rem 0;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.1);\n    color: white;\n    animation: slideIn 0.3s ease-out;\n}\n\n.activity-edit span {\n    display: block;\n    font-size: 1.2rem;\n    font-weight: 600;\n    margin-bottom: 1rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.activity-edit .activity-actions {\n    display: flex;\n    gap: 0.75rem;\n    margin-top: 1rem;\n}\n\n/* Cancel Button u edit view */\n.activity-edit .activity-actions button:last-child {\n    background: rgba(255, 255, 255, 0.2);\n    color: white;\n    border: 2px solid rgba(255, 255, 255, 0.3);\n}\n\n.activity-edit .activity-actions button:last-child:hover {\n    background: rgba(255, 255, 255, 0.3);\n    border-color: white;\n    transform: translateY(-2px);\n}\n\n/* Animation za edit */\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Pulse animation za edit mode */\n@keyframes pulse {\n    0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }\n    70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }\n    100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }\n}\n\n.activity-edit {\n    animation: slideIn 0.3s ease-out, pulse 2s infinite;\n}\n\n/* Smooth transitions za HTMX swap */\n.activity-block.htmx-swapping {\n    opacity: 0;\n    transition: opacity 0.3s ease-out;\n}\n\n.activity-block.htmx-added {\n    opacity: 0;\n}\n\n.activity-block {\n    opacity: 1;\n    transition: opacity 0.3s ease-in;\n}\n\n/* Responsive edit */\n@media (max-width: 768px) {\n    .activity-edit .activity-actions {\n        flex-direction: column;\n    }\n    \n    .activity-edit .activity-actions button {\n        width: 100%;\n    }\n}\&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id id\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target \&quot;this\&quot;\n      :hx-swap \&quot;outerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:60px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     [:div.activity-content\n      (str title \&quot;  \&quot; intensity \&quot;  \&quot; duration \&quot;h\&quot;)]]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div.activity-edit\n   {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:span \&quot;Edit mode\&quot;]\n   [:div.activity-actions\n    [:button {:hx-delete \&quot;/activity\&quot;\n              :hx-vals (generate-string {:id id})\n              :hx-target (str \&quot;#activity-\&quot; id)\n              :hx-swap \&quot;outerHTML\&quot;}]\n    \&quot;Delete\&quot;]\n   [:button\n    {:hx-get \&quot;/activity-view\&quot;\n     :hx-vals (generate-string {:id id})\n     :hx-target \&quot;closest .activity-block\&quot;\n     :hx-swap \&quot;innerHTML\&quot;}\n    \&quot;Cancel\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-view-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)\n        activity (first (filter #(= (:id %) id)\n                                (get-in session [:activities day])))]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html [:div.activity-content\n                         (str (:title activity) \&quot;  \&quot;\n                              (:intensity activity) \&quot;  \&quot;\n                              (:duration activity) \&quot;h\&quot;)]) )}))\n\n(defn activity-delete-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (update-in session [:activities day]\n                         (fn [acts]\n                           (vec (remove #(= (:id %) id) acts))))\n     :body \&quot;\&quot;}\n    )\n  )\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    [\&quot;/activity-view\&quot; {:get activity-view-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 17339, :ns &quot;web.server&quot;} {:command &quot;(ns web.server\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def port 3000)\n(defn parse-date [date-str]\n  (if (or (empty? date-str) (= \&quot;today\&quot; date-str))\n    (LocalDate/now)\n    (try (LocalDate/parse date-str)\n         (catch Exception _ (LocalDate/now)))))\n\n(defn format-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;yyyy-MM-dd\&quot;)))\n\n(defn nice-date [date]\n  (.format date (DateTimeFormatter/ofPattern \&quot;EEEE, dd. MMMM yyyy.\&quot;)))\n\n(defn get-next-day [date]\n  (.plusDays date 1))\n(defn get-previous-day [date]\n  (.minusDays date 1))\n\n(defn insant-&gt;minutes-from-midnight [inst]\n  (let [zdt (.atZone (.toInsant inst) (project.time/zone))\n        hour (.getHour zdt)\n        minute (.getMinute zdt)\n        (+ (* hour 60) minute)]))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n      \&quot;\n         /* RESET &amp; BASE */\n         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }\n         body { background-color: #f8f9fa; color: #333; display: flex; height: 100vh; overflow: hidden; }\n\n         /* SIDEBAR */\n         .sidebar { width: 260px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; z-index: 50; }\n         .logo { font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 40px; padding-left: 10px; }\n         .nav-link { display: flex; align-items: center; padding: 12px 15px; color: #555; text-decoration: none; border-radius: 8px; margin-bottom: 5px; font-weight: 500; transition: all 0.2s; }\n         .nav-link:hover { background-color: #f0f4f8; color: #2c3e50; }\n         .nav-link span { margin-right: 12px; font-size: 1.1em; }\n\n         /* MAIN CONTENT */\n         .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; }\n         h2 { font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 600; }\n\n         /* DAY SELECTOR */\n         #days-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; border: 1px solid #e0e0e0; width: fit-content; }\n         .day-column { padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; color: #777; transition: all 0.2s; border: 1px solid transparent; }\n         .day-column:hover { background-color: #f8f9fa; color: #333; }\n         .day-column.selected { background-color: #2c3e50; color: white; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }\n\n         /* KALENDAR GRID */\n         .calendar-wrapper { position: relative; background: white; border-radius: 12px; border: 1px solid #e0e0e0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }\n         .calendar-scroll { height: 70vh; overflow-y: auto; position: relative; } /* Skroluje samo kalendar */\n\n         .hour-row { height: 60px; border-bottom: 1px solid #f0f0f0; position: relative; display: flex; align-items: center; z-index: 1; }\n         .hour-label { width: 60px; text-align: right; padding-right: 15px; color: #999; font-size: 12px; font-weight: 500; user-select: none;}\n         .hour-slot { flex: 1; height: 100%; cursor: pointer; transition: background 0.1s; position: relative; border-left: 1px solid #f0f0f0; z-index: 1; }\n         .hour-slot:hover { background-color: #fcfcfc; }\n\n         /* FORMA U SLOTU */\n         .slot-form-container { padding: 10px; background: white; border-radius: 6px; z-index: 10000;\n         box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; position: absolute;\n         top: 5px; left: 5px; width: 600px; animation: fadeIn 0.2s; pointer-events: auto;\n         isolation: isolate; transform: translateZ(0); }\n         .slot-form { display: flex; gap: 8px; flex-wrap: wrap; }\n         .slot-form-row { display: flex; gap: 8px; width: 100%; }\n         .slot-form select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #fff; flex: 1; font-size: 13px; }\n         .slot-form button { padding: 8px 15px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 13px; }\n         .slot-form button:hover { background: #34495e; }\n\n         /* AKTIVNOST BLOK */\n         .activity-block {\n             position: absolute; left: 125px; right: 10px;\n             background: #e3f2fd; border-left: 4px solid #2196f3;\n             color: #1565c0; padding: 8px 12px; border-radius: 4px;\n             font-size: 13px; font-weight: 500;\n             box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n             cursor: pointer; transition: transform 0.1s;\n             z-index: 30; pointer-events: auto;\n             display: flex; align-items: center; justify-content: space-between;\n         }\n         .activity-block:hover { transform: scale(1.01); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }\n         .activity-actions button { background: none; border: none; cursor: pointer; color: #d32f2f; font-size: 12px; font-weight: bold; }\n\n          .activity-actions {}\n          .activity-actions button {padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\n          transition: all 0.2s ease; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px;}\n          .activity-actions button:first-child {background: #ff4757; color: white;}\n          .activity-actions button:first-child:hover {background: #ff3838; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);}\n\n         @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }\n      \&quot;]]\n\n    [:body\n     [:div.sidebar\n      [:div.logo-wrapper\n       [:div.logo \&quot;BeBetter\&quot;]]\n      [:ul.sidebar-menu\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;\\uD83C\\uDFE0\&quot;] [:span \&quot;Feed\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;‚ö°\&quot;] [:span \&quot;Aktivnost\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üèÜ\&quot;] [:span \&quot;Rang Lista\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üîç\&quot;] [:span \&quot;Pretraga\&quot;]]]\n       [:li [:a.nav-link {:href \&quot;#\&quot;} [:span \&quot;üë§\&quot;] [:span \&quot;Moj Profil\&quot;]]]]]\n     [:main.main-content\n      content]]))\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(def days [\&quot;Mon\&quot; \&quot;Tue\&quot; \&quot;Wed\&quot; \&quot;Thu\&quot; \&quot;Fri\&quot; \&quot;Sat\&quot; \&quot;Sun\&quot;])\n\n(defn day-column [selected-day]\n  [:div {:id \&quot;days-nav\&quot;\n         :style \&quot;display: flex; gap: 1rem; margin-bottom: 20px;\&quot;}\n   (for [d days]\n     [:div.day-column\n      {:class (when (= d selected-day) \&quot;selected\&quot;)\n       :hx-post \&quot;/select-day\&quot;\n       :hx-vals (generate-string {:day d})\n       :hx-target \&quot;#calendar-view\&quot;\n       :hx-swap \&quot;outerHTML\&quot;}\n      d])])\n\n(defn activity-&gt;block [{:keys [id title intensity duration hour]}]\n  (let [top (* 60 hour)\n        height (* duration 60)]\n    [:div.activity-block\n     {:id (str \&quot;activity-\&quot; id)\n      :hx-get \&quot;/activity-edit\&quot;\n      :hx-target (str \&quot;#activity-\&quot; id)\n      :hx-swap \&quot;innerHTML\&quot;\n      :hx-vals (generate-string {:id id})\n      :style (str \&quot;position:absolute;\&quot;\n                  \&quot;top:\&quot; top \&quot;px;\&quot;\n                  \&quot;left:60px;\&quot;\n                  \&quot;right:0;\&quot;\n                  \&quot;height:\&quot; height \&quot;px;\&quot;\n                  \&quot;background:#2c3e50;\&quot;\n                  \&quot;color:white;\&quot;\n                  \&quot;border-radius:6px;\&quot;\n                  \&quot;padding:6px;\&quot;\n                  \&quot;pointer-events: auto;\&quot;\n                  )}\n     [:div.activity-content\n      (str title \&quot;  \&quot; intensity \&quot;  \&quot; duration \&quot;h\&quot;)]]))\n\n(defn calendar-view [day activities]\n  [:div#calendar-view.calendar\n   [:h3 (str \&quot;Day: \&quot; (or day \&quot;Monday\&quot;))]\n   [:div.calendar-wrapper\n    [:div.calendar-scroll\n     [:div#slots-layer\n      (for [hour (range 24)]\n       [:div.hour-row\n        [:div.hour-label (str hour \&quot;:00\&quot;)]\n        [:div.hour-slot\n         {:hx-get \&quot;/slot-form\&quot;\n          :hx-vals (generate-string {:hour hour})\n          :hx-target \&quot;this\&quot;\n          :hx-swap \&quot;innerHTML\&quot;\n          :hx-trigger \&quot;click once\&quot;\n\n          }]])]\n     [:div#calendar-form-layer {:style \&quot;position:absolute;\n          top:0;\n          left:0;\n          right:0;\n          height:1440px;\n          z-index:20;\n          pointer-events: none\&quot;}\n      (for [a activities]\n        (activity-&gt;block a))]\n     ]\n    ]])\n\n\n(defn slot-form [hour]\n  [:div.slot-form-container  {:style \&quot;position:absolute; top:5px; left:5px; z-index:1000;\&quot;\n                              :onclick \&quot;event.stopPropagation()\&quot;}\n   [:form.slot-form\n    {:hx-post \&quot;/add-activity\&quot;\n     :hx-target \&quot;#calendar-form-layer\&quot;\n     :hx-swap \&quot;beforeend\&quot;\n     :hx-on:after-request \&quot;this.closest('.slot-form-container').remove()\&quot;\n     :onsubmit \&quot;this.querySelector('button[type=submit]').disabled = true;\&quot;\n     :style \&quot;display: flex; gap: 10px; align-items: center;\&quot;\n    }\n\n    [:input {:type \&quot;hidden\&quot; :name \&quot;hour\&quot; :value hour}]\n\n    [:select {:name \&quot;title\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Activity\&quot;]\n     [:option {:value \&quot;training\&quot;} \&quot;Training\&quot;]\n     [:option {:value \&quot;study\&quot;} \&quot;Study\&quot;]\n     [:option {:value \&quot;work\&quot;} \&quot;Work\&quot;]]\n\n    [:select {:name \&quot;intensity\&quot; :required true }\n     [:option {:value \&quot;\&quot; :selected true :disabled true :hidden true} \&quot;Choose Intensity\&quot;]\n     [:option {:value \&quot;low\&quot;} \&quot;Low\&quot;]\n     [:option {:value \&quot;mid\&quot;} \&quot;Mid\&quot;]\n     [:option {:value \&quot;high\&quot;} \&quot;High\&quot;]]\n\n    [:select {:name \&quot;duration\&quot;}\n     [:option {:value \&quot;1\&quot;} \&quot;1h\&quot;]\n     [:option {:value \&quot;2\&quot;} \&quot;2h\&quot;]\n     [:option {:value \&quot;3\&quot;} \&quot;3h\&quot;]\n     [:option {:value \&quot;4\&quot;} \&quot;4h\&quot;]]\n\n    [:button {:type \&quot;submit\&quot; } \&quot;Save\&quot;]\n    [:button {:type \&quot;button\&quot;\n              :onclick \&quot;this.closest('.slot-form-container').remove()\&quot;\n              :style \&quot;background: #ccc; color: black;\&quot;} \&quot;X\&quot;]]])\n\n(defn activity-edit-view [id]\n  [:div.activity-edit\n   {:style \&quot;background:#fff; border:1px solid #ccc; padding:6px; border-radius:6px;\&quot;}\n   [:span \&quot;Edit mode\&quot;]\n   [:div.activity-actions\n    [:button {:hx-delete \&quot;/activity\&quot;\n              :hx-vals (generate-string {:id id})\n              :hx-target (str \&quot;#activity-\&quot; id)\n              :hx-swap \&quot;delete\&quot;}]\n    \&quot;Delete\&quot;]\n   [:button\n    {:hx-get \&quot;/activity-view\&quot;\n     :hx-vals (generate-string {:id id})\n     :hx-target \&quot;closest .activity-block\&quot;\n     :hx-swap \&quot;innerHTML\&quot;}\n    \&quot;Cancel\&quot;]])\n\n(defn home-page [{:keys [session]}]\n  (let [selected-day (:select-day session \&quot;Mon\&quot;)\n        activities (get-in session [:activities selected-day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div\n        [:h2 \&quot;Calendar\&quot;]\n        (day-column selected-day)\n        (calendar-view selected-day activities)])}))\n\n(defn select-day-handler [{:keys [params session]}]\n  (let [day (:day params)\n        activities (get-in session [:activities day] [])]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (assoc session :select-day day)\n     :body (str (str (h/html (calendar-view day activities)))\n                (str (h/html [:div {:id \&quot;days-nav\&quot; :hx-swap-oob \&quot;true\&quot;}\n                              (for [d days]\n                                [:div.day-column\n                                 {:class (when (= d day) \&quot;selected\&quot;)\n                                  :hx-post \&quot;/select-day\&quot;\n                                  :hx-vals (generate-string {:day d})\n                                  :hx-target \&quot;#calendar-view\&quot;\n                                  :hx-swap \&quot;outerHTML\&quot;}\n                                 d])])))}))\n\n(defn slot-form-handler [{:keys [params]}]\n  (let [hour (:hour params)]\n    {:status  200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body    (str (h/html (slot-form hour)))\n     }))\n\n(defn add-activity-handler [{:keys [params session]}]\n  (println \&quot;PARAMS:\&quot; params)\n  (let [day (:select-day session \&quot;Mon\&quot;)\n        id (str (UUID/randomUUID))\n        new-activity {:id id\n                      :title (:title params)\n                      :duration (Integer/parseInt (:duration params))\n                      :intensity (:intensity params)\n                      :hour (Integer/parseInt (:hour params)  )}\n        new-session (update-in session [:activities day] (fnil conj []) new-activity)\n        ]\n\n\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session new-session\n     :body\n     (str\n       (h/html (activity-&gt;block new-activity)))}))\n\n(defn activity-edit-handler [{:keys [params]}]\n  (let [id (:id params)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html (activity-edit-view id)))})\n  )\n\n(defn activity-view-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)\n        activity (first (filter #(= (:id %) id)\n                                (get-in session [:activities day])))]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body (str (h/html [:div {:hx-get \&quot;/activity-edit\&quot;\n                               :hx-vals (generate-string {:id id})\n                               :hx-target (str \&quot;#activity-\&quot; id)\n                               :hx-swap \&quot;innerHTML\&quot;\n                               :style \&quot;height:100%; cursor:pointer;\&quot;}\n                         (str (:title activity) \&quot;  \&quot;\n                              (:intensity activity) \&quot;  \&quot;\n                              (:duration activity) \&quot;h\&quot;)]) )}))\n\n(defn activity-delete-handler [{:keys [params session]}]\n  (let [id (:id params)\n        day (:select-day session)]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :session (update-in session [:activities day]\n                         (fn [acts]\n                           (vec (remove #(= (:id %) id) acts))))\n     :body \&quot;\&quot;}\n    )\n  )\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    [\&quot;/select-day\&quot; {:post select-day-handler}]\n                    [\&quot;/slot-form\&quot; {:get slot-form-handler}]\n                    [\&quot;/add-activity\&quot; {:post add-activity-handler}]\n                    [\&quot;/activity-edit\&quot; {:get activity-edit-handler}]\n                    [\&quot;/activity\&quot; {:delete activity-delete-handler}]\n                    [\&quot;/favicon.ico\&quot; {:get (fn [_] {:status 204 :body \&quot;\&quot;})}]\n                    [\&quot;/activity-view\&quot; {:get activity-view-handler}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))     ; https://ericnormand.me/guide/clojure-web-tutorial\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.interrupt s)\n    (reset! server nil)))&quot;, :offset 15769, :ns &quot;web.server&quot;} {:command &quot;(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))&quot;, :offset 128, :ns &quot;web.server&quot;} {:command &quot;stop&quot;, :offset 4, :ns &quot;web.server&quot;} {:command &quot;(stop-server)&quot;, :offset 12, :ns &quot;web.server&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))&quot;, :offset 705, :ns &quot;web.server&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style]\n     ]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h1 \&quot;Hello WOrld\&quot;])\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port port :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1656, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style]\n     ]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h1 \&quot;Hello WOrld\&quot;])\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1656, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(start-server)&quot;, :offset 13, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h1 \&quot;Hello WOrld\&quot;])\n     })&quot;, :offset 162, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style]\n     ]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h1 \&quot;Hello WOrld\&quot;]\n       [:div \&quot;Hello world\&quot;])\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1684, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]\n     ]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     \n       [:h1 \&quot;Hello WOrld\&quot;]\n       [:div \&quot;Hello world\&quot;]\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1670, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]\n     ]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n\n       [:h1 \&quot;Hello WOrld\&quot;]\n       \n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1645, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]\n     ]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n        [:div \&quot;Hello World\&quot;]\n\n\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1640, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )&quot;, :offset 249, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n        [:div \&quot;Hello World\&quot;]\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1687, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div \&quot;Hello World\&quot;])\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1707, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div \&quot;Hello WorldNigger\&quot;])\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n&quot;, :offset 1713, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          on      (reduce-kv (fn [m k v]\n                               (assoc m (keyword (str \&quot;hx-on:\&quot; (name k))) v))\n                             {} on)))&quot;, :offset 603, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style ]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n        [:div.sidebar \&quot;sidebar\&quot;]\n        \n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2452, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style \&quot;\n     .div.sidebar {border-right: 1px solid var(--color-gray-300);\\n  width: 17rem;}\&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n        [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2530, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style \&quot;\n     .sidebar {border-right: 1px solid var(--color-gray-300);\\n  width: 17rem;}\n     .nav\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div.nav \&quot;Nav\&quot;]\n        [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2566, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style \&quot;\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-grey-300);}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div.nav \&quot;Nav\&quot;]\n        [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2614, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style \n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-grey-300);}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div.nav \&quot;Nav\&quot;]\n       [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2877, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px #d1d5db;  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-grey-300);}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div.nav \&quot;Nav\&quot;]\n       [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2856, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px #d1d5db;  width: 17rem;}\n     .nav {border-bottom: 1px #9ca3af;}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div.nav \&quot;Nav\&quot;]\n       [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2836, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px #d1d5db;  width: 17rem;}\n     .nav {border-bottom: 1px #9ca3af;}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     [:div.nav \&quot;Nav\&quot;]\n     [:div.sidebar \&quot;sidebar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div.nav \&quot;Nav\&quot;]\n       [:div.sidebar \&quot;sidebar\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2888, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px #d1d5db;  width: 17rem;}\n     .nav {border-bottom: 1px #9ca3af;}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     [:div.nav \&quot;Nav\&quot;]\n     [:div.sidebar \&quot;sidebar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2855, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px solid #d1d5db;  width: 17rem;}\n     .nav {border-bottom: 1px solid #9ca3af;}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     [:div.nav \&quot;Nav\&quot;]\n     [:div.sidebar \&quot;sidebar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2867, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px solid --color-gray-300;  width: 17rem;}\n     .nav {border-bottom: 1px solid --color-gray-400;}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     [:div.nav \&quot;Nav\&quot;]\n     [:div.sidebar \&quot;sidebar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2885, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style\n     \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n     \&quot;]]\n    [:body\n     [:h1 \&quot;BeBetterCalendar\&quot;]\n     [:div.nav \&quot;Nav\&quot;]\n     [:div.sidebar \&quot;sidebar\&quot;]\n     content]\n    )\n    )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 2895, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(def css-styles \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--color-gray-300: #d1d5db;    --color-gray-400: #9ca3af;}\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n     \&quot;)&quot;, :offset 421, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;\\n  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;\\n  --color-gray-300: #d1d5db;  --color-white: #ffffff;\\n\\n  --color-text-dark: #030712;}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n     .button {\\n  font-size: var(--font-size-sm);\\n  line-height: var(--line-height-sm);\\n  font-weight: 400;\\n\n     border-radius: var(--border-radius-md);\\n  border: none;\\n  padding: 0 1rem;\\n  height: 2.125rem;\\n  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;\\n}\n     .button--secondary {\\n  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);\\n}\\n\\n.button--secondary:hover {\\n  background-color: var(--color-gray-100);\\n}\n     .button--icon {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {\\n  width: 1rem;\\n}\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div.sidebar \&quot;Sidebar\&quot;]\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n    [:button.button.button--secondary.desktop-only \&quot;Today\&quot;]\n    (nav-arrows)]\n   [:time.nav__date date]])\n\n(defn nav [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body\n   [:div.nav\n    [:button.button.button--icon.button--secondary.mobile-only]]} )\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 4769, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;\\n  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;\\n  --color-gray-300: #d1d5db;  --color-white: #ffffff;\\n\\n  --color-text-dark: #030712;}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n\n     .button {\\n  font-size: var(--font-size-sm);\\n  line-height: var(--line-height-sm);\\n  font-weight: 400;\\n\n     border-radius: var(--border-radius-md);\\n  border: none;\\n  padding: 0 1rem;\\n  height: 2.125rem;\\n  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;\\n}\n     .button--secondary {\\n  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);\\n}\n     .button--secondary:hover {\\n  background-color: var(--color-gray-100);\\n}\n     .button--icon {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {\\n  width: 1rem;\\n}\n     .nav {\\n  border-bottom: 1px solid var(--color-gray-300);\\n  display: flex;\\n  padding: 0.5rem 1rem;\\n  gap: 1rem;\\n}\n     .nav__date-info {\\n  flex: 1;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  flex-direction: row-reverse;\\n}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;\\n    gap: 0;\\n    padding: 0.5rem;\\n  }\n                                  .nav__date-info {\\n    flex-direction: row;\\n    justify-content: flex-start;    gap: 1rem;\\n }\n                                  .nav__controls {\\n    gap: 0.5rem;  }}\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div.sidebar \&quot;Sidebar\&quot;]\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)]} )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 5590, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;\\n  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;\\n  --color-gray-300: #d1d5db;  --color-white: #ffffff;\\n\\n  --color-text-dark: #030712;}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n\n     .button {\\n  font-size: var(--font-size-sm);\\n  line-height: var(--line-height-sm);\\n  font-weight: 400;\\n\n     border-radius: var(--border-radius-md);\\n  border: none;\\n  padding: 0 1rem;\\n  height: 2.125rem;\\n  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;\\n}\n     .button--secondary {\\n  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);\\n}\n     .button--secondary:hover {\\n  background-color: var(--color-gray-100);\\n}\n     .button--icon {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {\\n  width: 1rem;\\n}\n     .nav {\\n  border-bottom: 1px solid var(--color-gray-300);\\n  display: flex;\\n  padding: 0.5rem 1rem;\\n  gap: 1rem;\\n}\n     .nav__date-info {\\n  flex: 1;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  flex-direction: row-reverse;\\n}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;\\n    gap: 0;\\n    padding: 0.5rem;\\n  }\n                                  .nav__date-info {\\n    flex-direction: row;\\n    justify-content: flex-start;    gap: 1rem;\\n }\n                                  .nav__controls {\\n    gap: 0.5rem;  }}\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div.sidebar \&quot;Sidebar\&quot;]\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)]} )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n        (nav (LocalDate/now))\n       )\n     })\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 5619, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;\\n  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;\\n  --color-gray-300: #d1d5db;  --color-white: #ffffff;\\n\\n  --color-text-dark: #030712;}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n\n     .button {\\n  font-size: var(--font-size-sm);\\n  line-height: var(--line-height-sm);\\n  font-weight: 400;\\n\n     border-radius: var(--border-radius-md);\\n  border: none;\\n  padding: 0 1rem;\\n  height: 2.125rem;\\n  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;\\n}\n     .button--secondary {\\n  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);\\n}\n     .button--secondary:hover {\\n  background-color: var(--color-gray-100);\\n}\n     .button--icon {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {\\n  width: 1rem;\\n}\n     .nav {\\n  border-bottom: 1px solid var(--color-gray-300);\\n  display: flex;\\n  padding: 0.5rem 1rem;\\n  gap: 1rem;\\n}\n     .nav__date-info {\\n  flex: 1;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  flex-direction: row-reverse;\\n}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;\\n    gap: 0;\\n    padding: 0.5rem;\\n  }\n                                  .nav__date-info {\\n    flex-direction: row;\\n    justify-content: flex-start;    gap: 1rem;\\n }\n                                  .nav__controls {\\n    gap: 0.5rem;  }}\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div.sidebar \&quot;Sidebar\&quot;]\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n        (nav {:date (LocalDate/now) :view \&quot;week\&quot;} )\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 5779, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n     .nav {border-bottom: 1px solid var(--color-gray-400);}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div.sidebar \&quot;Sidebar\&quot;]\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n       (sidebar)\n        (nav {:date (LocalDate/now) :view \&quot;week\&quot;} )\n       \n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6633, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n     \n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n      \n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div.sidebar \&quot;Sidebar\&quot;]\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n       (sidebar)\n        (nav {:date (LocalDate/now) :view \&quot;week\&quot;} )\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6745, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n       (sidebar)\n        (nav {:date (LocalDate/now) :view \&quot;week\&quot;} )\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6703, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:h2 \&quot;Welcome\&quot;]\n       [:div (sidebar)]\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6715, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:main.main content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n       [:div (sidebar)]\n       \n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6701, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      \n      [:main.main\n       [:div (sidebar)]\n       content]]\n     ]\n    )\n    )\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n\n\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6709, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n\n      [:main.main\n       [:div (sidebar)]\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n       content]]\n     ]\n    )\n  )\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n       \n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6707, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     @media (min-width: 768px) {  .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n                                  .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n                                  .nav__controls {    gap: 0.5rem;  }}\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div (sidebar)]\n      [:main.main\n       \n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n       content]]\n     ]\n    )\n  )\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6706, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {  font-family: ui-sans-serif, system-ui, sans-serif;  margin: 0;  padding: 0;  box-sizing: border-box;}\n     body {  font-size: 16px;  line-height: 1.5;  color: var(--color-text-dark);}\n     :root {--font-size-sm: 0.875rem;  --font-size-lg: 1.125rem;  --line-height-sm: 1.25rem;  --line-height-lg: 1.75rem;\n     --border-radius-md: 0.25rem;  --duration-sm: 100ms;  --color-gray-100: #f3f4f6;  --color-gray-300: #d1d5db;  --color-white: #ffffff;  --color-text-dark: #030712;}\n\n     .app {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  height: 100vh;\\n}\n     .main {\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n}\n\n     .sidebar {border-right: 1px solid var(--color-gray-300);  width: 17rem;}\n\n     .button {  font-size: var(--font-size-sm);  line-height: var(--line-height-sm);  font-weight: 400;\n     border-radius: var(--border-radius-md);  border: none;  padding: 0 1rem;  height: 2.125rem;  cursor: pointer;\n     transition: background-color var(--duration-sm) ease-out;}\n     .button--secondary {  background-color: var(--color-white);  border: 1px solid var(--color-gray-300);\n     color: var(--color-text-dark);}\n     .button--secondary:hover {  background-color: var(--color-gray-100);}\n     .button--icon {  display: flex;  align-items: center;  justify-content: center;  width: 2.125rem;  padding: 0;\n     border: none;}\n     .button__icon {  width: 1rem;}\n\n     .nav {  border-bottom: 1px solid var(--color-gray-300);  display: flex;  padding: 0.5rem 1rem;  gap: 1rem;}\n     .nav__date-info {  flex: 1;  display: flex;  align-items: center;  justify-content: space-between;  flex-direction: row-reverse;}\n     .nav-arrows { display: flex;\\n  gap: 0.125rem;}\n     .nav__controls {\\n  display: flex;\\n  gap: 0.125rem;\\n}\n     .nav__date {\\n  font-size: var(--font-size-lg);\\n  line-height: var(--line-height-lg);\\n}\n     @media (min-width: 768px) {\n     .nav {    justify-content: space-between;    gap: 0;    padding: 0.5rem;  }\n     .nav__date-info {    flex-direction: row;    justify-content: flex-start;    gap: 1rem; }\n     .nav__controls {    gap: 0.5rem;  }}\n\n     .select {  position: relative;  color: var(--color-text-dark);}\n     .select__select {font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark);\n     background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem;\n     height: 2.125rem;  cursor: pointer;  appearance: none;}\n     .select__icon {\\n  position: absolute;\\n  top: 50%;\\n  right: 0.5rem;\\n  transform: translateY(-50%);\\n  width: 1.125rem;\\n  pointer-events: none;\\n}\n\n     \&quot;)\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div (sidebar)]\n      [:main.main\n\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n       content]]\n     ]\n    )\n  )\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6855, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles \&quot;\n* {\n  font-family: ui-sans-serif, system-ui, sans-serif;\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  font-size: 16px;\n  line-height: 1.5;\n  color: var(--color-text-dark);\n}\n\n:root {\n  --font-size-sm: 0.875rem;\n  --font-size-lg: 1.125rem;\n  --line-height-sm: 1.25rem;\n  --line-height-lg: 1.75rem;\n  --border-radius-md: 0.25rem;\n  --duration-sm: 100ms;\n  --color-gray-100: #f3f4f6;\n  --color-gray-300: #d1d5db;\n  --color-white: #ffffff;\n  --color-text-dark: #030712;\n}\n\n.app {\n  display: grid;\n  grid-template-columns: auto 1fr;\n  height: 100vh;\n}\n\n.main {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n.sidebar {\n  border-right: 1px solid var(--color-gray-300);\n  width: 17rem;\n}\n\n.button {\n  font-size: var(--font-size-sm);\n  line-height: var(--line-height-sm);\n  font-weight: 400;\n  border-radius: var(--border-radius-md);\n  border: none;\n  padding: 0 1rem;\n  height: 2.125rem;\n  cursor: pointer;\n  transition: background-color var(--duration-sm) ease-out;\n}\n\n.button--secondary {\n  background-color: var(--color-white);\n  border: 1px solid var(--color-gray-300);\n  color: var(--color-text-dark);\n}\n\n.button--secondary:hover {\n  background-color: var(--color-gray-100);\n}\n\n.button--icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2.125rem;\n  padding: 0;\n  border: none;\n}\n\n.button__icon {\n  width: 1rem;\n}\n\n.nav {\n  border-bottom: 1px solid var(--color-gray-300);\n  display: flex;\n  padding: 0.5rem 1rem;\n  gap: 1rem;\n}\n\n.nav__date-info {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-direction: row-reverse;\n}\n\n.nav-arrows {\n  display: flex;\n  gap: 0.125rem;\n}\n\n.nav__controls {\n  display: flex;\n  gap: 0.125rem;\n}\n\n.nav__date {\n  font-size: var(--font-size-lg);\n  line-height: var(--line-height-lg);\n}\n\n@media (min-width: 768px) {\n  .nav {\n    justify-content: space-between;\n    gap: 0;\n    padding: 0.5rem;\n  }\n  \n  .nav__date-info {\n    flex-direction: row;\n    justify-content: flex-start;\n    gap: 1rem;\n  }\n  \n  .nav__controls {\n    gap: 0.5rem;\n  }\n}\n\n.select {\n  position: relative;\n  color: var(--color-text-dark);\n}\n\n.select__select {\n  font-size: var(--font-size-sm);\n  line-height: var(--line-height-sm);\n  font-weight: 400;\n  color: var(--color-text-dark);\n  background-color: transparent;\n  border-radius: var(--border-radius-md);\n  border: 1px solid var(--color-gray-300);\n  padding: 0 2rem 0 0.75rem;\n  height: 2.125rem;\n  cursor: pointer;\n  appearance: none;\n}\n\n.select__icon {\n  position: absolute;\n  top: 50%;\n  right: 0.5rem;\n  transform: translateY(-50%);\n  width: 1.125rem;\n  pointer-events: none;\n}\n\&quot;)\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div (sidebar)]\n      [:main.main\n\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n       content]]\n     ]\n    )\n  )\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6816, :ns &quot;web.calendar-tutorial&quot;} {:command &quot;(ns web.calendar-tutorial\n  (:require [ring.adapter.jetty :as jetty]\n            [reitit.ring :as ring]\n            [reitit.ring.middleware.parameters :as parameters]\n            [ring.middleware.keyword-params :refer [wrap-keyword-params]]\n            [hiccup.page :refer [html5]]\n            [hiccup2.core :as h]\n            [project.api :as api]\n            [datomic.api :as d]\n            [project.system :as sys]\n            [clojure.string :as str]\n            [ring.middleware.session :refer [wrap-session]]\n            [cheshire.core :refer :all]\n            )\n  (:import (java.time LocalDate LocalTime Duration ZoneId)\n           (java.time.format DateTimeFormatter)\n           (java.util UUID)))\n\n(def css-styles\n  (str/trim \&quot;\n    * { font-family: ui-sans-serif, system-ui, sans-serif; margin: 0; padding: 0; box-sizing: border-box; }\n    body { font-size: 16px; line-height: 1.5; color: var(--color-text-dark); }\n    :root { --font-size-sm: 0.875rem; --font-size-lg: 1.125rem; --line-height-sm: 1.25rem; --line-height-lg: 1.75rem; --border-radius-md: 0.25rem; --duration-sm: 100ms; --color-gray-100: #f3f4f6; --color-gray-300: #d1d5db; --color-white: #ffffff; --color-text-dark: #030712; }\n    .app { display: grid; grid-template-columns: auto 1fr; height: 100vh; }\n    .main { display: flex; flex-direction: column; height: 100%; }\n    .sidebar { border-right: 1px solid var(--color-gray-300); width: 17rem; }\n    .button { font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; border-radius: var(--border-radius-md); border: none; padding: 0 1rem; height: 2.125rem; cursor: pointer; transition: background-color var(--duration-sm) ease-out; }\n    .button--secondary { background-color: var(--color-white); border: 1px solid var(--color-gray-300); color: var(--color-text-dark); }\n    .button--secondary:hover { background-color: var(--color-gray-100); }\n    .button--icon { display: flex; align-items: center; justify-content: center; width: 2.125rem; padding: 0; border: none; }\n    .button__icon { width: 1rem; }\n    .nav { border-bottom: 1px solid var(--color-gray-300); display: flex; padding: 0.5rem 1rem; gap: 1rem; }\n    .nav__date-info { flex: 1; display: flex; align-items: center; justify-content: space-between; flex-direction: row-reverse; }\n    .nav__controls { display: flex; gap: 0.125rem; }\n    .nav__arrows { display: flex; gap: 0.125rem; }\n    .nav__date { font-size: var(--font-size-lg); line-height: var(--line-height-lg); }\n    @media (min-width: 768px) { .nav { justify-content: space-between; gap: 0; padding: 0.5rem; } .nav__date-info { flex-direction: row; justify-content: flex-start; gap: 1rem; } .nav__controls { gap: 0.5rem; } }\n    .select { position: relative; color: var(--color-text-dark); }\n    .select__select { font-size: var(--font-size-sm); line-height: var(--line-height-sm); font-weight: 400; color: var(--color-text-dark); background-color: transparent; border-radius: var(--border-radius-md); border: 1px solid var(--color-gray-300); padding: 0 2rem 0 0.75rem; height: 2.125rem; cursor: pointer; appearance: none; }\n    .select__icon { position: absolute; top: 50%; right: 0.5rem; transform: translateY(-50%); width: 1.125rem; pointer-events: none; }\n    .calendar { height: 100%; }\n    @media (min-width: 768px) { .mobile-only { display: none; } }\n    @media (max-width: 767px) { .desktop-only { display: none; } }\n  \&quot;))\n(defn sidebar []\n  [:div.sidebar\n   [:div.logo-wrapper\n    [:span \&quot;BeBetter\&quot;]]\n   [:ul.sidebar-menu\n    [:a.nav-link\n     [:li [:span \&quot;Activity\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Feed\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Leaderboard\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;Search\&quot;]]]\n    [:a.nav-link\n     [:li [:span \&quot;My Profile\&quot;]]]]])\n\n\n(defn hamburger-btn []\n  [:button.button.button--icon.button--secondary.mobile-only\n   [:svg {:xmlns \&quot;http://www.w3.org/2000/svg\&quot;\n          :width 24 :height 24 :viewBox \&quot;0 0 24 24\&quot;\n          :fill \&quot;none\&quot; :stroke \&quot;currentColor\&quot;\n          :stroke-width 2 :stroke-linecap \&quot;round\&quot; :stroke-linejoin \&quot;round\&quot;}\n    [:line {:x1 4 :x2 20 :y1 12 :y2 12}]\n    [:line {:x1 4 :x2 20 :y1 6 :y2 6}]\n    [:line {:x1 4 :x2 20 :y1 18 :y2 18}]]])\n\n\n(defn nav-arrows []\n  [:div.nav__arrows\n   [:button.button.button--icon.button--secondary \&quot;‚Üê\&quot;]\n   [:button.button.button--icon.button--secondary \&quot;‚Üí\&quot;]])\n\n(defn nav-date-info [date]\n  [:div.nav__date-info\n   [:div.nav__controls\n   [:button.button.button--secondary.desktop-only\n    {:hx-get \&quot;/today\&quot;}\n    \&quot;Today\&quot;]\n   (nav-arrows)]\n   [:time.nav__date date]]\n  )\n(defn view-select [current]\n  [:div.select.desktop-only\n   [:select.select__select\n    {:hx-get \&quot;/change-view\&quot;}\n    (for [v [\&quot;day\&quot; \&quot;week\&quot; \&quot;month\&quot;]]\n      [:option {:value v :selected (= v current)}\n       (clojure.string/capitalize v)])]])\n\n(defn nav [{:keys [date view]}]\n   [:div.nav\n    (hamburger-btn)\n    (nav-date-info date)\n    (view-select view)] )\n\n(defn common-layout [&amp; content]\n  (html5\n    [:head\n     [:title \&quot;BeBetter\&quot;]\n     [:meta {:charset \&quot;UTF-8\&quot;}]\n     [:script {:src \&quot;https://unpkg.com/htmx.org@1.9.10\&quot;}]\n     [:style css-styles]]\n    [:body\n     [:div.app\n      [:div (sidebar)]\n      [:main.main\n\n       [:div (nav {:date (LocalDate/now) :view \&quot;week\&quot;})]\n       content]]\n     ]\n    )\n  )\n(defn home-page [{:keys [session]}]\n    {:status 200\n     :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n     :body\n     (common-layout\n\n       )\n     })\n\n(defn nav-handler [request]\n  {:status 200\n   :headers {\&quot;Content-Type\&quot; \&quot;text/html\&quot;}\n   :body (h/html (nav {:date (LocalDate/now) :view \&quot;week\&quot;}))})\n\n(def app\n  (wrap-session\n    (ring/ring-handler\n      (ring/router [[\&quot;/\&quot; {:get home-page}]\n                    ]\n                   {:data {:middleware [parameters/parameters-middleware\n                                        wrap-keyword-params]}}))))\n\n(defonce server (atom nil))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (jetty/run-jetty #'app {:port 3000 :join? false}))\n    (println \&quot;server pokrenut na http://localhost:3000\&quot;)))\n\n(defn stop-server []\n  (when-some [s @server] ;; check if there is an object in the atom\n    (.stop s)\n    (reset! server nil)))\n\n(defn hx\n  [{:keys [get post delete target swap trigger vals on oob]}]\n  (cond-&gt; {}\n          get     (assoc :hx-get get)\n          post    (assoc :hx-post post)\n          delete  (assoc :hx-delete delete)\n          target  (assoc :hx-target target)\n          swap    (assoc :hx-swap (name swap))\n          trigger (assoc :hx-trigger trigger)\n          vals    (assoc :hx-vals (generate-string vals))\n          oob     (assoc :hx-swap-oob \&quot;true\&quot;)\n          (and on (map? on))\n          (merge (reduce-kv (fn [m k v]\n                              (assoc m\n                                (keyword (str \&quot;hx-on:\&quot; (name k)))\n                                v))\n                            {}\n                            on))))&quot;, :offset 6854, :ns &quot;web.calendar-tutorial&quot;}], :remote []}}</component>
  <component name="RunManager" selected="Clojure REPL.REPL for ProjectV1">
    <configuration default="true" type="Babashka" factoryName="BabashkaLocalRepl" activateToolWindowBeforeRun="false">
      <setting name="displayName" value="" />
      <setting name="bbPath" value="" />
      <setting name="parameters" value="" />
      <option name="PARENT_ENVS" value="true" />
      <setting name="workingDir" value="" />
      <setting name="focusEditor" value="false" />
      <method v="2">
        <option name="Make" enabled="true" />
      </method>
    </configuration>
    <configuration name="REPL for ProjectV1" type="ClojureREPL" factoryName="Local" activateToolWindowBeforeRun="false">
      <option name="configVersion" value="1" />
      <option name="displayName" value="REPL for ProjectV1" />
      <option name="execution" value="LEININGEN" />
      <module name="ProjectV1" />
      <option name="options" />
      <option name="profiles" />
      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
      <method v="2" />
    </configuration>
    <configuration default="true" type="ClojureREPL" factoryName="Local" activateToolWindowBeforeRun="false">
      <option name="configVersion" value="1" />
      <option name="options" />
      <option name="profiles" />
      <method v="2" />
    </configuration>
    <configuration default="true" type="ClojureREPL" factoryName="Remote" activateToolWindowBeforeRun="false">
      <setting name="displayName" value="" />
      <setting name="host" value="" />
      <setting name="port" value="0" />
      <setting name="replType" value="SOCKET" />
      <setting name="configType" value="SPECIFY" />
      <setting name="replPortFileType" value="STANDARD" />
      <setting name="customPortFile" value="" />
      <setting name="fixLineNumbers" value="false" />
      <setting name="useHeartbeat" value="true" />
      <setting name="focusEditor" value="false" />
      <setting name="urlFile" value="" />
      <method v="2" />
    </configuration>
    <configuration name="Test project.api-test/delta-test" type="ClojureTestRunConfiguration" factoryName="clojure.test" temporary="true">
      <module name="ProjectV1" />
      <option name="selector" value="SINGLE_VAR" />
      <option name="varFqn" value="project.api-test/delta-test" />
      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
      <method v="2" />
    </configuration>
    <configuration name="Test project.api-test/leaderboard-rank-ties-test" type="ClojureTestRunConfiguration" factoryName="clojure.test" temporary="true">
      <module name="ProjectV1" />
      <option name="selector" value="SINGLE_VAR" />
      <option name="varFqn" value="project.api-test/leaderboard-rank-ties-test" />
      <option name="WORKING_DIRECTORY" value="$PROJECT_DIR$" />
      <method v="2" />
    </configuration>
    <recent_temporary>
      <list>
        <item itemvalue="clojure.test.Test project.api-test/delta-test" />
        <item itemvalue="clojure.test.Test project.api-test/leaderboard-rank-ties-test" />
      </list>
    </recent_temporary>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-jdk-9823dce3aa75-fbdcb00ec9e3-intellij.indexing.shared.core-IU-251.25410.129" />
        <option value="bundled-js-predefined-d6986cc7102b-6a121458b545-JavaScript-IU-251.25410.129" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="4d338447-6f3a-43e8-ab8c-95e214f36644" name="Changes" comment="" />
      <created>1767121985479</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1767121985479</updated>
      <workItem from="1767121986415" duration="3674000" />
      <workItem from="1767181139032" duration="1494000" />
      <workItem from="1767351215899" duration="6476000" />
      <workItem from="1767379148928" duration="2673000" />
      <workItem from="1767381868455" duration="67000" />
      <workItem from="1767472762290" duration="1088000" />
      <workItem from="1767537145030" duration="11000" />
      <workItem from="1767625268145" duration="5102000" />
      <workItem from="1767694847080" duration="18149000" />
      <workItem from="1767804228503" duration="9080000" />
      <workItem from="1767892649731" duration="8974000" />
      <workItem from="1767906416609" duration="6067000" />
      <workItem from="1767958972899" duration="595000" />
      <workItem from="1768070963735" duration="14388000" />
      <workItem from="1768129866250" duration="9988000" />
      <workItem from="1768149678456" duration="13189000" />
      <workItem from="1768171748332" duration="36000" />
      <workItem from="1768403682096" duration="4369000" />
      <workItem from="1768474526888" duration="8177000" />
      <workItem from="1768491610839" duration="3377000" />
      <workItem from="1768587661011" duration="10613000" />
      <workItem from="1768638813832" duration="14723000" />
      <workItem from="1768662775460" duration="5330000" />
      <workItem from="1768736915225" duration="291000" />
      <workItem from="1768771507620" duration="5414000" />
      <workItem from="1768808685053" duration="10422000" />
      <workItem from="1768828344403" duration="6339000" />
      <workItem from="1768841963659" duration="9097000" />
      <workItem from="1768919011338" duration="96000" />
      <workItem from="1769022282280" duration="7836000" />
      <workItem from="1769075977686" duration="8791000" />
      <workItem from="1769089486580" duration="5158000" />
      <workItem from="1769124897316" duration="72000" />
      <workItem from="1769184242641" duration="3047000" />
      <workItem from="1769250460539" duration="3000" />
      <workItem from="1769333055758" duration="3673000" />
      <workItem from="1769361640551" duration="10655000" />
      <workItem from="1769419857978" duration="11966000" />
      <workItem from="1769452940043" duration="2856000" />
      <workItem from="1769540791944" duration="4000" />
      <workItem from="1769548779354" duration="4444000" />
      <workItem from="1769589827861" duration="3658000" />
      <workItem from="1769618988716" duration="2355000" />
      <workItem from="1769677511044" duration="15282000" />
      <workItem from="1769697916247" duration="11000" />
      <workItem from="1769710839254" duration="4017000" />
      <workItem from="1769806496931" duration="2000" />
      <workItem from="1769808410217" duration="692000" />
      <workItem from="1769851791837" duration="8364000" />
      <workItem from="1769867711662" duration="3820000" />
      <workItem from="1769886709383" duration="12294000" />
      <workItem from="1770036313639" duration="3000" />
      <workItem from="1770051578848" duration="4629000" />
    </task>
    <task id="LOCAL-00001" summary="Ucitan je Datomic, sad vezbam koriscenje kroz dokumentaciju">
      <option name="closed" value="true" />
      <created>1767125847824</created>
      <option name="number" value="00001" />
      <option name="presentableId" value="LOCAL-00001" />
      <option name="project" value="LOCAL" />
      <updated>1767125847824</updated>
    </task>
    <task id="LOCAL-00002" summary="Dodate neke default funkcije koje rade sa bazom u datomicu">
      <option name="closed" value="true" />
      <created>1767367199446</created>
      <option name="number" value="00002" />
      <option name="presentableId" value="LOCAL-00002" />
      <option name="project" value="LOCAL" />
      <updated>1767367199446</updated>
    </task>
    <task id="LOCAL-00003" summary="Uradjene kreiraj korisnika i dodaj xp u bazi">
      <option name="closed" value="true" />
      <created>1767381886292</created>
      <option name="number" value="00003" />
      <option name="presentableId" value="LOCAL-00003" />
      <option name="project" value="LOCAL" />
      <updated>1767381886292</updated>
    </task>
    <task id="LOCAL-00004" summary="Uradjene kreiraj korisnika i dodaj xp u bazi 2">
      <option name="closed" value="true" />
      <created>1767483540530</created>
      <option name="number" value="00004" />
      <option name="presentableId" value="LOCAL-00004" />
      <option name="project" value="LOCAL" />
      <updated>1767483540530</updated>
    </task>
    <task id="LOCAL-00005" summary="Provezbana funkcija add-xp">
      <option name="closed" value="true" />
      <created>1767634382925</created>
      <option name="number" value="00005" />
      <option name="presentableId" value="LOCAL-00005" />
      <option name="project" value="LOCAL" />
      <updated>1767634382925</updated>
    </task>
    <task id="LOCAL-00006" summary="transakciona funkcija koja dodaje xp useru, kreirana sema aktivnosti/event koje user izvrsava da bi dobio xp, &#10;kreirana sema tipa aktivnosti koja ima main tip aktivnosti.&#10;odvajam kod u dva paketa db i main paket, &#10;i db.clj u dva fajla schema.clj, seed.clj gde cu imati back ako mi se nesto zezne kao na primer da ubacim dva worka...">
      <option name="closed" value="true" />
      <created>1767734960862</created>
      <option name="number" value="00006" />
      <option name="presentableId" value="LOCAL-00006" />
      <option name="project" value="LOCAL" />
      <updated>1767734960862</updated>
    </task>
    <task id="LOCAL-00007" summary="transakciona funkcija koja dodaje xp useru, kreirana sema aktivnosti/event koje user izvrsava da bi dobio xp, &#10;kreirana sema tipa aktivnosti koja ima main tip aktivnosti.&#10;odvajam kod u dva paketa db i main paket, &#10;i db.clj u dva fajla schema.clj, seed.clj gde cu imati back ako mi se nesto zezne kao na primer da ubacim dva worka...">
      <option name="closed" value="true" />
      <created>1767734966394</created>
      <option name="number" value="00007" />
      <option name="presentableId" value="LOCAL-00007" />
      <option name="project" value="LOCAL" />
      <updated>1767734966394</updated>
    </task>
    <task id="LOCAL-00008" summary="Uh, datomic je malo naporan iskreno, ali zanimljiv jer je sve kao u clojuru. Odvojio sam scheme i seed, pohvatao sam fazon sa transakcijama, i kako se sta pise">
      <option name="closed" value="true" />
      <created>1767742945250</created>
      <option name="number" value="00008" />
      <option name="presentableId" value="LOCAL-00008" />
      <option name="project" value="LOCAL" />
      <updated>1767742945250</updated>
    </task>
    <task id="LOCAL-00009" summary="Kreirana funkcija activity/add, sustina app, na osnovu parametara se izracuna xp za odredjenu aktivnost">
      <option name="closed" value="true" />
      <created>1767812289892</created>
      <option name="number" value="00009" />
      <option name="presentableId" value="LOCAL-00009" />
      <option name="project" value="LOCAL" />
      <updated>1767812289893</updated>
    </task>
    <task id="LOCAL-00010" summary="Fixed add-activity-tx,&#10;user-activities -&gt; query for finding all activities of one user">
      <option name="closed" value="true" />
      <created>1767902122657</created>
      <option name="number" value="00010" />
      <option name="presentableId" value="LOCAL-00010" />
      <option name="project" value="LOCAL" />
      <updated>1767902122657</updated>
    </task>
    <task id="LOCAL-00011" summary="Daily activities by user - list of every activity done in one day.&#10;Daily-xp - user can be put in leaderboard to compete and compare daily activities with other people.">
      <option name="closed" value="true" />
      <created>1767915212637</created>
      <option name="number" value="00011" />
      <option name="presentableId" value="LOCAL-00011" />
      <option name="project" value="LOCAL" />
      <updated>1767915212637</updated>
    </task>
    <task id="LOCAL-00012" summary="Daily, Weekly and Monthly activities and xp per user">
      <option name="closed" value="true" />
      <created>1768083937606</created>
      <option name="number" value="00012" />
      <option name="presentableId" value="LOCAL-00012" />
      <option name="project" value="LOCAL" />
      <updated>1768083937606</updated>
    </task>
    <task id="LOCAL-00013" summary="Daily, Weekly and Monthly activities and xp per user">
      <option name="closed" value="true" />
      <created>1768085174478</created>
      <option name="number" value="00013" />
      <option name="presentableId" value="LOCAL-00013" />
      <option name="project" value="LOCAL" />
      <updated>1768085174478</updated>
    </task>
    <task id="LOCAL-00014" summary="Fixing old code, erasing and moving unnecessary and outdated functions. &#10;Setting up better architecture, more readable">
      <option name="closed" value="true" />
      <created>1768162612523</created>
      <option name="number" value="00014" />
      <option name="presentableId" value="LOCAL-00014" />
      <option name="project" value="LOCAL" />
      <updated>1768162612523</updated>
    </task>
    <task id="LOCAL-00015" summary="Testing of malli validation">
      <option name="closed" value="true" />
      <created>1768165269540</created>
      <option name="number" value="00015" />
      <option name="presentableId" value="LOCAL-00015" />
      <option name="project" value="LOCAL" />
      <updated>1768165269540</updated>
    </task>
    <task id="LOCAL-00016" summary="Malli validation, validate! function">
      <option name="closed" value="true" />
      <created>1768167032069</created>
      <option name="number" value="00016" />
      <option name="presentableId" value="LOCAL-00016" />
      <option name="project" value="LOCAL" />
      <updated>1768167032069</updated>
    </task>
    <task id="LOCAL-00017" summary="Validation of transaction function add-activity and create user">
      <option name="closed" value="true" />
      <created>1768169307460</created>
      <option name="number" value="00017" />
      <option name="presentableId" value="LOCAL-00017" />
      <option name="project" value="LOCAL" />
      <updated>1768169307460</updated>
    </task>
    <task id="LOCAL-00018" summary="Leaderboard for one day, week and month">
      <option name="closed" value="true" />
      <created>1768495590013</created>
      <option name="number" value="00018" />
      <option name="presentableId" value="LOCAL-00018" />
      <option name="project" value="LOCAL" />
      <updated>1768495590013</updated>
    </task>
    <task id="LOCAL-00019" summary="Leaderboard finito">
      <option name="closed" value="true" />
      <created>1768592793347</created>
      <option name="number" value="00019" />
      <option name="presentableId" value="LOCAL-00019" />
      <option name="project" value="LOCAL" />
      <updated>1768592793347</updated>
    </task>
    <task id="LOCAL-00020" summary="Leaderboard finito 2, merged daily, weekly, monthly leaderboard function in one function, all time leaderboard is still by itself">
      <option name="closed" value="true" />
      <created>1768600694449</created>
      <option name="number" value="00020" />
      <option name="presentableId" value="LOCAL-00020" />
      <option name="project" value="LOCAL" />
      <updated>1768600694449</updated>
    </task>
    <task id="LOCAL-00021" summary="Leaderboard finito 3, i merged even all-time in default leaderboard fn, so now code is clearer and less messy. Deleted unnecessary fucntion i no longer use. Added 3 tests for 2 for adding activity and 1 for leaderboard.">
      <option name="closed" value="true" />
      <created>1768661297153</created>
      <option name="number" value="00021" />
      <option name="presentableId" value="LOCAL-00021" />
      <option name="project" value="LOCAL" />
      <updated>1768661297153</updated>
    </task>
    <task id="LOCAL-00022" summary="API preparing for frontend, did some validation">
      <option name="closed" value="true" />
      <created>1768779315145</created>
      <option name="number" value="00022" />
      <option name="presentableId" value="LOCAL-00022" />
      <option name="project" value="LOCAL" />
      <updated>1768779315145</updated>
    </task>
    <task id="LOCAL-00023" summary="Leaderboard with rank and ties in xp">
      <option name="closed" value="true" />
      <created>1768833163143</created>
      <option name="number" value="00023" />
      <option name="presentableId" value="LOCAL-00023" />
      <option name="project" value="LOCAL" />
      <updated>1768833163143</updated>
    </task>
    <task id="LOCAL-00024" summary="Leaderboard delta, calculate changes in rank">
      <option name="closed" value="true" />
      <created>1768855602635</created>
      <option name="number" value="00024" />
      <option name="presentableId" value="LOCAL-00024" />
      <option name="project" value="LOCAL" />
      <updated>1768855602635</updated>
    </task>
    <task id="LOCAL-00025" summary="Leaderboard delta still">
      <option name="closed" value="true" />
      <created>1768859643777</created>
      <option name="number" value="00025" />
      <option name="presentableId" value="LOCAL-00025" />
      <option name="project" value="LOCAL" />
      <updated>1768859643777</updated>
    </task>
    <task id="LOCAL-00026" summary="Leaderboard delta test, edge case -&gt; when new user is added, how he evaluate,&#10;I failed today, it needs fix tomorrow.">
      <option name="closed" value="true" />
      <created>1769039313571</created>
      <option name="number" value="00026" />
      <option name="presentableId" value="LOCAL-00026" />
      <option name="project" value="LOCAL" />
      <updated>1769039313571</updated>
    </task>
    <task id="LOCAL-00027" summary="Leaderboard delta test, edge case -&gt; when new user is added, how he evaluate,&#10;Fixed, problem was in test data">
      <option name="closed" value="true" />
      <created>1769078211847</created>
      <option name="number" value="00027" />
      <option name="presentableId" value="LOCAL-00027" />
      <option name="project" value="LOCAL" />
      <updated>1769078211847</updated>
    </task>
    <task id="LOCAL-00028" summary="Change to clojure.test, done 2 tests">
      <option name="closed" value="true" />
      <created>1769124957289</created>
      <option name="number" value="00028" />
      <option name="presentableId" value="LOCAL-00028" />
      <option name="project" value="LOCAL" />
      <updated>1769124957289</updated>
    </task>
    <task id="LOCAL-00029" summary="Front end using htmx with hiccup.Using ring for web server and metosin reitit for routes/ with hiccup. &#10;Server is up, and most basic leaderboard is shown.">
      <option name="closed" value="true" />
      <created>1769377318034</created>
      <option name="number" value="00029" />
      <option name="presentableId" value="LOCAL-00029" />
      <option name="project" value="LOCAL" />
      <updated>1769377318034</updated>
    </task>
    <task id="LOCAL-00030" summary="Practicing htmx basics">
      <option name="closed" value="true" />
      <created>1769433573151</created>
      <option name="number" value="00030" />
      <option name="presentableId" value="LOCAL-00030" />
      <option name="project" value="LOCAL" />
      <updated>1769433573151</updated>
    </task>
    <task id="LOCAL-00031" summary="Practicing htmx basics 2">
      <option name="closed" value="true" />
      <created>1769467170509</created>
      <option name="number" value="00031" />
      <option name="presentableId" value="LOCAL-00031" />
      <option name="project" value="LOCAL" />
      <updated>1769467170509</updated>
    </task>
    <task id="LOCAL-00032" summary="Day picker and 24h planner">
      <option name="closed" value="true" />
      <created>1769555708729</created>
      <option name="number" value="00032" />
      <option name="presentableId" value="LOCAL-00032" />
      <option name="project" value="LOCAL" />
      <updated>1769555708729</updated>
    </task>
    <task id="LOCAL-00033" summary="Formated code, instagram sidebar">
      <option name="closed" value="true" />
      <created>1769642325281</created>
      <option name="number" value="00033" />
      <option name="presentableId" value="LOCAL-00033" />
      <option name="project" value="LOCAL" />
      <updated>1769642325281</updated>
    </task>
    <task id="LOCAL-00034" summary="Select time, it does not fully work, will fix">
      <option name="closed" value="true" />
      <created>1769687989801</created>
      <option name="number" value="00034" />
      <option name="presentableId" value="LOCAL-00034" />
      <option name="project" value="LOCAL" />
      <updated>1769687989801</updated>
    </task>
    <task id="LOCAL-00035" summary="User can choose activity, intensity, duration and remove activity">
      <option name="closed" value="true" />
      <created>1769697572550</created>
      <option name="number" value="00035" />
      <option name="presentableId" value="LOCAL-00035" />
      <option name="project" value="LOCAL" />
      <updated>1769697572550</updated>
    </task>
    <task id="LOCAL-00036" summary="Front, form is under hour-row, cant fix it">
      <option name="closed" value="true" />
      <created>1769867454023</created>
      <option name="number" value="00036" />
      <option name="presentableId" value="LOCAL-00036" />
      <option name="project" value="LOCAL" />
      <updated>1769867454023</updated>
    </task>
    <task id="LOCAL-00037" summary="Front, can add activity on front, cant delete it, it looks okay">
      <option name="closed" value="true" />
      <created>1769871551290</created>
      <option name="number" value="00037" />
      <option name="presentableId" value="LOCAL-00037" />
      <option name="project" value="LOCAL" />
      <updated>1769871551290</updated>
    </task>
    <option name="localTasksCounter" value="38" />
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
  <component name="Vcs.Log.Tabs.Properties">
    <option name="TAB_STATES">
      <map>
        <entry key="MAIN">
          <value>
            <State />
          </value>
        </entry>
      </map>
    </option>
  </component>
  <component name="VcsManagerConfiguration">
    <MESSAGE value="Daily, Weekly and Monthly activities and xp per user" />
    <MESSAGE value="Fixing old code, erasing and moving unnecessary and outdated functions. &#10;Setting up better architecture, more readable" />
    <MESSAGE value="Testing of malli validation" />
    <MESSAGE value="Malli validation, validate! function" />
    <MESSAGE value="Validation of transaction function add-activity and create user" />
    <MESSAGE value="Leaderboard for one day, week and month" />
    <MESSAGE value="Leaderboard finito" />
    <MESSAGE value="Leaderboard finito 2, merged daily, weekly, monthly leaderboard function in one function, all time leaderboard is still by itself" />
    <MESSAGE value="Leaderboard finito 3, i merged even all-time in default leaderboard fn, so now code is clearer and less messy. Deleted unnecessary fucntion i no longer use. Added 3 tests for 2 for adding activity and 1 for leaderboard." />
    <MESSAGE value="API preparing for frontend, did some validation" />
    <MESSAGE value="Leaderboard with rank and ties in xp" />
    <MESSAGE value="Leaderboard delta, calculate changes in rank" />
    <MESSAGE value="Leaderboard delta still" />
    <MESSAGE value="Leaderboard delta test, edge case -&gt; when new user is added, how he evaluate,&#10;I failed today, it needs fix tomorrow." />
    <MESSAGE value="Leaderboard delta test, edge case -&gt; when new user is added, how he evaluate,&#10;Fixed, problem was in test data" />
    <MESSAGE value="Change to clojure.test, done 2 tests" />
    <MESSAGE value="Front end using htmx with hiccup.Using ring for web server and metosin reitit for routes/ with hiccup. &#10;Server is up, and most basic leaderboard is shown." />
    <MESSAGE value="Practicing htmx basics" />
    <MESSAGE value="Practicing htmx basics 2" />
    <MESSAGE value="Day picker and 24h planner" />
    <MESSAGE value="Formated code, instagram sidebar" />
    <MESSAGE value="Select time, it does not fully work, will fix" />
    <MESSAGE value="User can choose activity, intensity, duration and remove activity" />
    <MESSAGE value="Front, form is under hour-row, cant fix it" />
    <MESSAGE value="Front, can add activity on front, cant delete it, it looks okay" />
    <option name="LAST_COMMIT_MESSAGE" value="Front, can add activity on front, cant delete it, it looks okay" />
  </component>
</project>